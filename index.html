<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Evento Gratuito de inversi√≥n inmobiliaria</title>
  <meta name="description" content="Evento gratuito de inversi√≥n inmobiliaria ‚Äî Lanzamiento de nuevo proyecto en Mirador de La Florida. Cupos limitados. Reg√≠strate para asegurar tu asistencia y recibir condiciones del lanzamiento." />
  <meta property="og:title" content="Evento Gratuito de inversi√≥n inmobiliaria" />
  <meta property="og:description" content="Evento gratuito de inversi√≥n inmobiliaria ‚Äî Lanzamiento de nuevo proyecto en Mirador de La Florida." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="hero-la-florida.jpg" />
  <meta property="og:url" content="https://www.selectcapital.cl/la-florida" />
  <meta name="theme-color" content="#0F172A" />
  <link rel="icon" href="favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: {
            ink:'#0F1217', accent:'#1E40AF', soft:'#F8FAFC', line:'#E5E7EB', hint:'#64748B', ok:'#16A34A'
          },
          boxShadow: { soft:'0 12px 32px rgba(2,6,23,.08)' }
        }
      }
    }
  </script>
  <style>
    html{scroll-behavior:smooth}
    .g-bg{background:linear-gradient(135deg,#0F172A 0%,#1E3A8A 60%,#1E40AF 100%)}
  </style>

  <!-- JSON-LD del evento -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Event",
    "name":"Evento Gratuito de inversi√≥n inmobiliaria",
    "startDate":"2025-11-11T19:30:00-03:00",
    "eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode",
    "eventStatus":"https://schema.org/EventScheduled",
    "location":{
      "@type":"Place",
      "name":"Best Western Premier Marina Las Condes",
      "address":"Alonso de C√≥rdova 5727, Las Condes, RM, Chile"
    },
    "image":"hero-la-florida.jpg",
    "description":"Lanzamiento de nuevo proyecto en Mirador de La Florida. Evento presencial con condiciones de lanzamiento y asesor√≠a personalizada.",
    "organizer":{"@type":"Organization","name":"Select Capital","url":""}
  }
  </script>

  <!-- GA4 (reemplaza G-XXXXXXXXXX) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    (function(){
      var MID = 'G-XXXXXXXXXX';
      if(!MID || MID === 'G-XXXXXXXXXX') return; 
      gtag('js', new Date()); 
      gtag('config', MID);
    })();
  </script>

  <!-- Meta Pixel (cargar solo si hay ID v√°lido) -->
  <script>
    (function(){
      var PIXEL_ID = 'YOUR_PIXEL_ID';
      if(!PIXEL_ID || PIXEL_ID === 'YOUR_PIXEL_ID') return;
      !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', PIXEL_ID);
    })();
  </script>
  <noscript>
    <!-- Solo relevante si hay PIXEL_ID real -->
  </noscript>

  <!-- Cloudflare Turnstile -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
  <!-- Meta de evento y barra de urgencia (desktop) -->
  <div id="event-meta" class="hidden" data-capacidad="60" data-registrados="42"></div>
  <div id="top-urgency" class="hidden md:flex fixed top-0 inset-x-0 z-50 bg-ink text-white text-sm">
    <div class="max-w-6xl mx-auto w-full px-4 py-2 flex items-center justify-between">
      <div class="flex items-center gap-2"><span class="text-emerald-400">‚óè</span><span id="top-urgency-text">Cierre de registro pr√≥ximamente</span></div>
      <a href="#form" class="rounded-lg bg-white text-ink px-3 py-1 font-semibold">Reservar ahora</a>
    </div>
  </div>

  <!-- Barra superior con CTA (sticky en mobile) -->
  <div class="fixed bottom-0 inset-x-0 z-40 md:static">
    <div class="md:hidden bg-white/90 backdrop-blur border-t border-line px-4 py-3">
      <div class="flex gap-3">
        <a href="#form" class="flex-1 inline-flex items-center justify-center rounded-xl bg-accent text-white font-semibold py-3" rel="noopener">Reservar Cupo</a>
        <a href="https://wa.me/56966013182?text=Hola%2C%20quiero%20info%20del%20evento%20La%20Florida"
           class="px-4 rounded-xl border border-line text-ink font-semibold bg-white" target="_blank" rel="noopener noreferrer">WhatsApp</a>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="g-bg text-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 pt-14 md:pt-20 pb-16 md:pb-20">
      <div class="grid md:grid-cols-2 gap-10 items-end">
        <div>
          <p class="inline-flex items-center gap-2 text-xs font-semibold bg-white/10 border border-white/15 rounded-full px-3 py-1 mb-4">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span> Cupos limitados ‚Ä¢ Evento presencial
          </p>
          <h1 class="text-4xl font-bold leading-tight">Evento Gratuito de inversi√≥n inmobiliaria</h1>
          <p class="mt-3 text-white/80">Lanzamiento de nuevo proyecto en Mirador de La Florida</p>
          <p class="mt-2 text-white/70">Desde UF 2.600 ‚Ä¢ Entrega 1S 2029 ‚Ä¢ Pre-reserva $9.990</p>
          <div class="mt-2 text-white/80 text-sm" id="ps-registrados" aria-live="polite"></div>
          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            <a href="#form" class="inline-flex items-center justify-center rounded-xl bg-white text-ink font-semibold px-5 py-3" rel="noopener">
              Quiero asistir
            </a>
            <a href="#evento" class="inline-flex items-center justify-center rounded-xl border border-white/30 text-white px-5 py-3" rel="noopener">
              Ver detalles
            </a>
          </div>
          <div class="mt-6">
            <div class="rounded-2xl bg-white/10 backdrop-blur border border-white/20 p-4">
              <p class="text-xs text-white/80 mb-2">Cierre de registro en</p>
              <div class="grid grid-cols-4 gap-2 text-center">
                <div class="bg-white/10 rounded-lg p-3"><div id="cd-d" class="text-2xl sm:text-3xl font-bold">--</div><div class="text-[11px] opacity-80">d√≠as</div></div>
                <div class="bg-white/10 rounded-lg p-3"><div id="cd-h" class="text-2xl sm:text-3xl font-bold">--</div><div class="text-[11px] opacity-80">horas</div></div>
                <div class="bg-white/10 rounded-lg p-3"><div id="cd-m" class="text-2xl sm:text-3xl font-bold">--</div><div class="text-[11px] opacity-80">min</div></div>
                <div class="bg-white/10 rounded-lg p-3"><div id="cd-s" class="text-2xl sm:text-3xl font-bold">--</div><div class="text-[11px] opacity-80">seg</div></div>
              </div>
              <div class="mt-4">
                <div class="h-2 rounded-full bg-white/15 overflow-hidden" aria-label="Progreso de inscripciones" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                  <div id="progressbar" class="h-2 bg-white/80" style="width:0%"></div>
                </div>
                <div class="mt-2 flex items-center justify-between text-xs text-white/80">
                  <span id="registrados-label"></span>
                  <div class="flex items-center gap-3">
                    <span id="cupos-text" aria-live="polite">Cupos limitados</span>
                    <a href="#form" class="inline-flex items-center gap-1 px-3 py-1 rounded-lg bg-white text-ink font-semibold">Reservar</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Visual ligero para buen LCP (placeholder sustituible) -->
        <div class="bg-white/10 border border-white/15 rounded-2xl p-4 shadow-soft">
          <picture>
            <source srcset="hero-la-florida.avif" type="image/avif" />
            <source srcset="hero-la-florida.webp" type="image/webp" />
            <img src="hero-la-florida.jpg" alt="Render del proyecto en La Florida" class="w-full aspect-[4/3] object-cover rounded-xl" loading="eager" width="1600" height="1200" />
          </picture>
          <div class="mt-3 grid grid-cols-3 gap-3 text-center text-xs">
            <div class="bg-white/10 rounded-lg p-3">
              <div class="text-xl font-bold">UF 2.600</div><div class="opacity-80">Desde</div>
            </div>
            <div class="bg-white/10 rounded-lg p-3">
              <div class="text-xl font-bold">2029</div><div class="opacity-80">Entrega</div>
            </div>
            <div class="bg-white/10 rounded-lg p-3">
              <div class="text-xl font-bold">Cup.</div><div class="opacity-80">Limitados</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- PROBADOR R√ÅPIDO -->
  <section class="bg-white border-b border-line">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
      <ul class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm">
        <li class="flex items-center gap-3 bg-soft rounded-xl p-3"><span class="w-2 h-2 rounded-full bg-ok"></span> Ubicaci√≥n top (metro + mall)</li>
        <li class="flex items-center gap-3 bg-soft rounded-xl p-3"><span class="w-2 h-2 rounded-full bg-ok"></span> Unidades desde UF 2.600 y pie en cuotas</li>
        <li class="flex items-center gap-3 bg-soft rounded-xl p-3"><span class="w-2 h-2 rounded-full bg-ok"></span> Asesor√≠a personalizada en sala</li>
      </ul>
    </div>
  </section>

  <!-- DETALLES DEL EVENTO -->
  <section id="evento" class="bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-12 md:py-14">
      <div class="grid md:grid-cols-2 gap-10 items-start">
        <div class="order-2 md:order-1">
          <h2 class="text-2xl md:text-3xl font-bold mb-2">Evento presencial</h2>
          <p class="text-hint mb-6">Condiciones de lanzamiento y selecci√≥n guiada de unidades.</p>
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <div class="shrink-0 w-9 h-9 rounded-full bg-soft flex items-center justify-center border border-line" aria-hidden="true">üìÖ</div>
              <div><div class="font-semibold">Martes 11 de noviembre ‚Ä¢ 19:30</div><div class="text-sm text-hint">Ingreso desde 19:10</div></div>
            </div>
            <div class="flex items-start gap-3">
              <div class="shrink-0 w-9 h-9 rounded-full bg-soft flex items-center justify-center border border-line" aria-hidden="true">üìç</div>
              <div><div class="font-semibold">Best Western Premier Marina Las Condes</div><div class="text-sm text-hint">Alonso de C√≥rdova 5727, Las Condes</div></div>
            </div>
            <div class="flex items-start gap-3">
              <div class="shrink-0 w-9 h-9 rounded-full bg-soft flex items-center justify-center border border-line" aria-hidden="true">üéÅ</div>
              <div><div class="font-semibold">Beneficios para asistentes</div><div class="text-sm text-hint">Cupos preferentes, condiciones del lanzamiento y asesor√≠a 1:1.</div></div>
            </div>
          </div>
          <div class="mt-6 flex gap-3">
            <a href="#form" class="inline-flex items-center justify-center rounded-xl bg-accent text-white font-semibold px-5 py-3">Reservar cupo</a>
            <a class="inline-flex items-center justify-center rounded-xl border border-line px-5 py-3"
               href="https://wa.me/56966013182?text=Hola%2C%20quiero%20confirmar%20mi%20asistencia%20al%20evento%20La%20Florida" target="_blank" rel="noopener noreferrer">WhatsApp</a>
          </div>
        </div>

        <div class="order-1 md:order-2 bg-soft rounded-2xl p-4 border border-line shadow-soft">
          <picture>
            <source srcset="evento.avif" type="image/avif" />
            <source srcset="evento.webp" type="image/webp" />
            <img src="evento.jpg" alt="Sala del evento" class="w-full aspect-video object-cover rounded-xl" loading="lazy" width="1280" height="720" />
          </picture>
        </div>
      </div>
    </div>
  </section>

  <!-- BENEFICIOS -->
  <section id="beneficios" class="bg-white border-y border-line">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-12">
      <div class="mb-8">
        <h2 class="text-2xl md:text-3xl font-bold">Beneficios clave</h2>
        <p class="text-sm text-hint mt-1">Lo m√°s importante en una mirada: por qu√© este proyecto y por qu√© estar en el lanzamiento.</p>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-soft rounded-2xl p-6 border border-line">
          <h3 class="text-lg font-semibold mb-4">Del proyecto</h3>
          <ul class="space-y-3 text-sm">
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚úì</span><span>Unidades desde UF 2.600 y pie en cuotas.</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚úì</span><span>Entrega planificada 1S 2029, permitiendo preparar financiamiento.</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚úì</span><span>Amenidades funcionales (cowork, gimnasio, salas multiuso, quinchos).</span></li>
          </ul>
        </div>

        <div class="bg-soft rounded-2xl p-6 border border-line">
          <h3 class="text-lg font-semibold mb-4">De asistir al lanzamiento</h3>
          <ul class="space-y-3 text-sm">
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚òÖ</span><span>Prioridad para elegir unidades con mejores condiciones.</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚òÖ</span><span>Acceso a condiciones de lanzamiento y stock reservado para sala.</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚òÖ</span><span>Asesor√≠a personalizada 1:1 (evaluaci√≥n de presupuesto y estrategia).</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚òÖ</span><span>Orientaci√≥n sobre financiamiento y bancos seg√∫n tu perfil.</span></li>
            <li class="flex gap-3"><span class="w-6 h-6 shrink-0 rounded-full bg-ok/15 text-ok flex items-center justify-center">‚òÖ</span><span>Confirmaci√≥n de pre-reserva en sala (cupos limitados).</span></li>
          </ul>
        </div>
      </div>

      <div class="mt-8 text-center">
        <a href="#form" class="inline-flex items-center justify-center rounded-xl bg-accent text-white font-semibold px-6 py-3">Quiero mi cupo en el lanzamiento</a>
        <p class="text-xs text-hint mt-2">Cupos limitados ‚Ä¢ Confirmaci√≥n por WhatsApp/email</p>
      </div>
    </div>
  </section>

  <!-- FORMULARIO -->
  <section id="form" class="bg-white border-y border-line">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
      <div class="bg-soft rounded-2xl p-6 md:p-8 border border-line shadow-soft">
        <h2 class="text-xl md:text-2xl font-bold mb-1">Reserva tu asistencia</h2>
        <p class="text-sm text-hint mb-3">Completa tus datos y te confirmaremos por correo/WhatsApp.</p>
        <div class="mb-6 flex items-center justify-between rounded-xl border border-line bg-white p-3">
          <div class="text-sm"><span class="font-semibold">Cupos restantes:</span> <span id="cupos-restantes-form">--</span></div>
          <span class="text-xs text-ink/70">Cierre en <span id="cd-small">--:--:--</span></span>
        </div>

        <!-- Opci√≥n B: backend propio -->
        <form action="/submit.php" method="POST" class="space-y-5" novalidate>
          <!-- UTM -->
          <input type="hidden" name="utm_source">
          <input type="hidden" name="utm_medium">
          <input type="hidden" name="utm_campaign">
          <input type="hidden" name="gclid">
          <input type="hidden" name="fbclid">
          <input type="hidden" name="ttclid">
          <input type="hidden" name="cf-turnstile-response" id="ts-token">
          <!-- Honeypot -->
          <input type="text" name="honey" class="hidden" tabindex="-1" autocomplete="off">

          <div class="grid sm:grid-cols-2 gap-4">
            <div>
              <label for="nombre" class="block text-sm font-semibold mb-1">Nombre completo</label>
              <input id="nombre" name="nombre" type="text" required autocomplete="name" autocapitalize="words"
                     class="w-full rounded-xl border border-line bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Tu nombre" />
            </div>
            <div>
              <label for="whatsapp" class="block text-sm font-semibold mb-1">WhatsApp</label>
              <input id="whatsapp" name="whatsapp" type="tel" required inputmode="tel" autocomplete="tel"
                     class="w-full rounded-xl border border-line bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-accent" placeholder="+56 9 xxxx xxxx" />
              <p id="w-error" class="mt-1 text-xs text-red-600 hidden" aria-live="polite"></p>
            </div>
          </div>

          <div>
            <label for="email" class="block text-sm font-semibold mb-1">Email</label>
            <input id="email" name="email" type="email" required autocomplete="email"
                   class="w-full rounded-xl border border-line bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-accent" placeholder="correo@ejemplo.com" />
            <p id="e-error" class="mt-1 text-xs text-red-600 hidden" aria-live="polite"></p>
          </div>

          <div>
            <label for="ingresos" class="block text-sm font-semibold mb-1">Rango de ingresos mensuales (CLP)</label>
            <select id="ingresos" name="ingresos_mensuales_clp" required
                    class="w-full rounded-xl border border-line bg-white px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-accent">
              <option value="" disabled selected>Selecciona tu rango</option>
              <option value="<700k">Menos de $700.000</option>
              <option value="700k-1m">$700.000 ‚Äì $1.000.000</option>
              <option value="1m-1.5m">$1.000.001 ‚Äì $1.500.000</option>
              <option value="1.5m-2m">$1.500.001 ‚Äì $2.000.000</option>
              <option value="2m-3m">$2.000.001 ‚Äì $3.000.000</option>
              <option value="3m-4m">$3.000.001 ‚Äì $4.000.000</option>
              <option value=">5m">M√°s de $5.000.000</option>
            </select>
            <p class="mt-1 text-xs text-hint">Usamos esta info para sugerirte la mejor estrategia de financiamiento.</p>
            <p id="i-error" class="mt-1 text-xs text-red-600 hidden" aria-live="polite"></p>
          </div>

          <label class="flex items-start gap-3 text-sm">
            <input type="checkbox" required name="consentimiento"
                   class="mt-1 rounded border-gray-300 text-accent focus:ring-accent" />
            <span>Acepto el tratamiento de mis datos seg√∫n la <strong>Ley 19.628</strong> y autorizo el contacto. Consulta nuestra 
              <a href="https://www.selectcapital.cl/privacidad" class="underline" target="_blank" rel="noopener noreferrer">Pol√≠tica de Privacidad</a>.</span>
          </label>

          <!-- Turnstile (anti-bot) -->
          <div class="cf-turnstile mt-2" data-sitekey="0x4AAAAAAB_bjq2YOWp-yEXx" data-theme="auto" data-callback="onTurnstileSuccess"></div>
          <p id="t-error" class="mt-1 text-xs text-red-600 hidden" aria-live="polite"></p>

          <div id="form-error" class="hidden text-sm text-red-600" role="alert" aria-live="polite"></div>

          <button id="submitBtn" type="submit"
                  class="w-full rounded-xl bg-accent text-white font-semibold py-3 hover:opacity-95 transition">
            <span id="s-text">Reservar mi cupo</span>
            <span id="s-load" class="hidden">Enviando‚Ä¶</span>
          </button>

          <p class="text-[11px] text-hint text-center">üîí Datos protegidos ‚Ä¢ Cupos limitados ‚Ä¢ Confirmaci√≥n por email/WhatsApp (en menos de 24h)</p>
        </form>
      </div>
    </div>
  </section>

  <!-- FAQ breve -->
  <section class="bg-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 py-10">
      <h3 class="text-lg font-bold mb-4">Preguntas frecuentes</h3>
      <div class="grid md:grid-cols-2 gap-4 text-sm">
        <div class="border border-line rounded-xl p-4">
          <p class="font-semibold mb-1">¬øTiene costo asistir?</p>
          <p class="text-hint">No. El evento es gratuito, con cupos limitados y confirmaci√≥n previa.</p>
        </div>
        <div class="border border-line rounded-xl p-4">
          <p class="font-semibold mb-1">¬øDebo llevar algo?</p>
          <p class="text-hint">Solo tu c√©dula y, si quieres, pre-aprobaci√≥n bancaria. Nosotros te guiamos.</p>
        </div>
        <div class="border border-line rounded-xl p-4">
          <p class="font-semibold mb-1">¬øSi no puedo ir?</p>
          <p class="text-hint">Puedes solicitar una reuni√≥n online y recibir condiciones del lanzamiento.</p>
        </div>
        <div class="border border-line rounded-xl p-4">
          <p class="font-semibold mb-1">¬øConfirman asistencia?</p>
          <p class="text-hint">S√≠, te contactaremos por WhatsApp/email para confirmar tu cupo.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-ink text-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-10">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="text-sm text-white/70">¬© <span id="year"></span> Select Capital. Todos los derechos reservados.</div>
        <div class="flex gap-3 text-sm">
          <a class="underline underline-offset-2" href="#form">Reservar cupo</a>
          <a class="underline underline-offset-2" href="mailto:contacto@selectcapital.cl">contacto@selectcapital.cl</a>
          <a class="underline underline-offset-2" href="tel:+56966013182">+56 9 6601 3182</a>
        </div>
      </div>
      <p class="mt-4 text-xs text-white/50">Valores y condiciones sujetos a disponibilidad. Ley 19.628 sobre protecci√≥n de datos.</p>
    </div>
  </footer>

  <script>
    // A√±o
    document.getElementById('year').textContent = new Date().getFullYear();

    // UTM autollenado
    const params = new URLSearchParams(location.search);
    const utmFields = ['utm_source','utm_medium','utm_campaign','gclid','fbclid','ttclid'];
    const form = document.querySelector('#form form');
    utmFields.forEach(k=>{
      const el = form.querySelector(`[name="${k}"]`);
      if(el) el.value = params.get(k) || '';
    });

    // Countdown visible hacia 11 Nov 2025 19:30 America/Santiago
    const target = new Date('2025-11-11T19:30:00-03:00').getTime();
    function fmt2(n){ return String(n).padStart(2,'0'); }
    function tick(){
      const now = Date.now();
      let diff = Math.max(0, target - now);
      const d = Math.floor(diff/86400000); diff%=86400000;
      const h = Math.floor(diff/3600000);  diff%=3600000;
      const m = Math.floor(diff/60000);    diff%=60000;
      const s = Math.floor(diff/1000);
      const cdD = document.getElementById('cd-d');
      const cdH = document.getElementById('cd-h');
      const cdM = document.getElementById('cd-m');
      const cdS = document.getElementById('cd-s');
      if(cdD) cdD.textContent = String(d);
      if(cdH) cdH.textContent = fmt2(h);
      if(cdM) cdM.textContent = fmt2(m);
      if(cdS) cdS.textContent = fmt2(s);
      const small = document.getElementById('cd-small');
      if(small) small.textContent = `${fmt2(h + d*24)}:${fmt2(m)}:${fmt2(s)}`;
    }
    tick(); setInterval(tick, 1000);

    // Urgencia de cupos
    const meta = document.getElementById('event-meta');
    let capacidad = 0, registrados = 0;
    if(meta){
      capacidad = parseInt(meta.dataset.capacidad||'0',10) || 0;
      registrados = parseInt(meta.dataset.registrados||'0',10) || 0;
    }
    const restantes = Math.max(0, capacidad - registrados);
    const cuposText = document.getElementById('cupos-text');
    const topUrg = document.getElementById('top-urgency-text');
    const topUrgBar = document.getElementById('top-urgency');
    const restForm = document.getElementById('cupos-restantes-form');
    const prog = document.getElementById('progressbar');
    const regLbl = document.getElementById('registrados-label');
    const pct = capacidad? Math.min(100, Math.round((registrados/capacidad)*100)) : 0;
    if(cuposText){ cuposText.textContent = capacidad ? `Quedan ${restantes} cupos` : 'Cupos limitados'; }
    if(topUrg){ topUrg.textContent = capacidad ? `Cierre de registro ‚Ä¢ Quedan ${restantes} cupos` : 'Cierre de registro ‚Ä¢ Cupos limitados'; }
    if(topUrgBar && capacidad){ topUrgBar.classList.remove('hidden'); }
    if(restForm){ restForm.textContent = capacidad ? `${restantes}` : 'pocos'; }
    if(regLbl){ regLbl.textContent = capacidad ? `${registrados}/${capacidad} inscritos (${pct}%)` : ''; }
    const ps = document.getElementById('ps-registrados');
    if(ps){ ps.textContent = capacidad ? `+${registrados} inversionistas registrados` : ''; }
    if(prog){ prog.style.width = pct + '%'; prog.setAttribute('aria-valuenow', String(pct)); }

    // Validaci√≥n ligera CL + correo + honeypot + UX de env√≠o
    const wInput = document.getElementById('whatsapp');
    const eInput = document.getElementById('email');
    const wError = document.getElementById('w-error');
    const eError = document.getElementById('e-error');
    const sBtn   = document.getElementById('submitBtn');
    const sText  = document.getElementById('s-text');
    const sLoad  = document.getElementById('s-load');
    const formError = document.getElementById('form-error');
    const honey  = form.querySelector('input[name="honey"]');
    const iSelect = document.getElementById('ingresos');
    const iError  = document.getElementById('i-error');
    let turnstileOk = false;
    const tsContainer = document.querySelector('.cf-turnstile');
    const tsError = document.getElementById('t-error');
    const tsToken = document.getElementById('ts-token');
    window.onTurnstileSuccess = function(token){
      if (tsToken) tsToken.value = token;
      turnstileOk = !!token; if(tsContainer && tsError) hideErr(tsContainer, tsError);
    };
    const reCL   = /^(?:\+?56\s?)?9\s?\d{4}\s?\d{4}$/;

    const showErr = (el, box, msg)=>{ el.setAttribute('aria-invalid','true'); box.textContent=msg; box.classList.remove('hidden'); }
    const hideErr = (el, box)=>{ el.setAttribute('aria-invalid','false'); box.classList.add('hidden'); }

    wInput.addEventListener('input', ()=>{
      let v = wInput.value.replace(/\s+/g,' ').trim();
      // Formateo suave: fuerza prefijo +56 9 si parte con 9 o 56
      v = v.replace(/^\+?56\s*9?\s*(\d{4})\s*(\d{4})$/, '+56 9 $1 $2')
           .replace(/^9\s*(\d{4})\s*(\d{4})$/, '+56 9 $1 $2');
      wInput.value = v;
      if(v && !reCL.test(v.replace(/\s/g,''))) showErr(wInput, wError, 'Usa formato chileno: +56 9 xxxx xxxx'); else hideErr(wInput, wError);
    });

    eInput.addEventListener('input', ()=>{
      const v = eInput.value.trim();
      if(v && !eInput.validity.valid) showErr(eInput, eError, 'Ingresa un correo v√°lido'); else hideErr(eInput, eError);
    });

    if(iSelect){
      iSelect.addEventListener('change', ()=>{
        if(iSelect.value) hideErr(iSelect, iError);
      });
    }

    form.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      if(honey.value) return; // bot
      let ok = true;
      if(!reCL.test(wInput.value.trim())){ showErr(wInput,wError,'Usa formato chileno: +56 9 xxxx xxxx'); ok=false; }
      if(!eInput.validity.valid){ showErr(eInput,eError,'Ingresa un correo v√°lido'); ok=false; }
      if(iSelect && !iSelect.value){ showErr(iSelect, iError, 'Selecciona tu rango de ingresos.'); ok=false; }
      if(tsContainer && (!turnstileOk || !tsToken || !tsToken.value)) { showErr(tsContainer, tsError, 'Confirma que no eres un robot.'); ok=false; }
      if(!ok) return;

      sBtn.disabled = true; sText.classList.add('hidden'); sLoad.classList.remove('hidden');

      // Microm√©trica simple
      try { console.log('form_submit_intent'); } catch(e){}

      // Env√≠o a tu backend (submit.php)
      try{
        const res = await fetch(form.action, { method:'POST', body:new FormData(form) });
        if(res.ok){
          console.log('form_submit_success');
          // Tracking de conversi√≥n
          try {
            if(window.gtag){ gtag('event','generate_lead',{event_category:'form', event_label:'evento_form'}); }
            window.dataLayer = window.dataLayer || []; window.dataLayer.push({event:'form_submit_success', form_id:'evento_form'});
            if(window.fbq){ fbq('track','CompleteRegistration'); }
          } catch(e) { console.warn('tracking_error', e); }
          // Redirige a Gracias con el nombre (aunque el backend tambi√©n 302)
          const nombreVal = (document.getElementById('nombre')?.value || '').trim();
          const url = 'gracias.html?' + new URLSearchParams({ nombre: nombreVal }).toString();
          setTimeout(()=>{ location.href = url; }, 200);
        } else {
          throw new Error('submit_failed');
        }
      }catch(e){
        console.error('form_submit_error', e);
        if(formError){ formError.textContent = 'No pudimos registrar tu asistencia. Intenta nuevamente en unos segundos.'; formError.classList.remove('hidden'); }
        sBtn.disabled = false; sText.classList.remove('hidden'); sLoad.classList.add('hidden');
      }
    });

    // ================================
    // TESTS (unitarios ligeros en runtime)
    // ================================
    (function runUnitTests(){
      const results = [];
      function test(name, fn){
        try { const ok = !!fn(); results.push({name, ok}); }
        catch(e){ results.push({name, ok:false, error: String(e)}); }
      }
      // Tel√©fono Chile
      const reCL = /^(?:\+?56\s?)?9\s?\d{4}\s?\d{4}$/;
      test('CL phone +56 9 1234 5678 v√°lido', ()=> reCL.test('+56 9 1234 5678'));
      test('CL phone 9 1234 5678 v√°lido',   ()=> reCL.test('9 1234 5678'));
      test('CL phone 912345678 v√°lido',      ()=> reCL.test('912345678'));
      test('Tel√©fono inv√°lido 12345678',     ()=> !reCL.test('12345678'));
      // Email (nativa)
      test('Email v√°lido simple', ()=> { const i=document.createElement('input'); i.type='email'; i.value='a@b.cl'; return i.checkValidity();});
      test('Email inv√°lido',      ()=> { const i=document.createElement('input'); i.type='email'; i.value='abc'; return !i.checkValidity();});
      // Select ingresos requerido presente
      const iSelect = document.getElementById('ingresos');
      test('Select ingresos existe y es required', ()=> iSelect && iSelect.hasAttribute('required'));
      // Turnstile presente
      test('Turnstile contenedor presente', ()=> !!document.querySelector('.cf-turnstile'));
      // Cupos: c√°lculos
      const meta = document.getElementById('event-meta');
      let capacidad = 0, registrados = 0;
      if(meta){ capacidad = parseInt(meta.dataset.capacidad||'0',10) || 0; registrados = parseInt(meta.dataset.registrados||'0',10) || 0; }
      const restantes = Math.max(0, capacidad - registrados);
      const prog = document.getElementById('progressbar');
      test('Cupos restantes calculado', ()=> { if(!meta||!capacidad) return true; return (capacidad-registrados)===restantes;});
      test('Progressbar porcentaje v√°lido', ()=> { if(!meta||!capacidad) return true; const n=parseInt((prog.style.width||'0').replace('%',''),10); return n>=0 && n<=100; });
      // Error inline render
      test('Form error inline existe', ()=> !!document.getElementById('form-error'));
      // Reporte
      const pass = results.filter(r=>r.ok).length;
      console.log(`[UNIT TESTS] ${pass}/${results.length} ok`, results);
    })();
  </script>
</body>
</html>


