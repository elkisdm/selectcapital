<!doctype html>
<html lang="es" data-theme="light" data-theme-transition>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Select Capital ‚Äî Asesor√≠a Integral Inmobiliaria</title>
    <meta name="description" content="Curamos proyectos con demanda real, negociamos beneficios y te acompa√±amos hasta la puesta en arriendo. Asesor√≠a sin costo." />
    <meta name="theme-color" content="#F6F8FC" />
    <link rel="icon" href="images/icono.png" />
    
    <!-- DNS Prefetch para recursos externos -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="dns-prefetch" href="https://challenges.cloudflare.com" />
    
    <!-- Preconnect para recursos cr√≠ticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Fuentes con font-display swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- CSS cr√≠tico -->
    <link rel="stylesheet" href="lenguaje visual/theme/select-capital-theme.min.css?v=66e592e976" />
    <link rel="stylesheet" href="lenguaje visual/forms/sc-forms.css?v=20250118" />
    <link rel="stylesheet" href="landing/proyecto-inmobiliario/viva-marin-styles.css?v=20250118-4" />
    <style>
      /* Estilos adicionales para la home provisional */
      .mission-section {
        margin: clamp(48px, 8vw, 80px) 0;
      }
      
      .mission-content {
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
      }
      
      .mission-title {
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--sc-text-primary);
      }
      
      .mission-text {
        font-size: clamp(1.1rem, 2.5vw, 1.25rem);
        line-height: 1.7;
        color: var(--sc-text-secondary);
        max-width: 700px;
        margin: 0 auto 2rem;
      }
      
      .mission-pillars {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 3rem;
      }
      
      .mission-pillar {
        padding: 1.5rem;
        border-radius: var(--lp-radius-lg);
        border: 1px solid var(--sc-border-glass, rgba(15, 23, 42, 0.1));
        background: var(--sc-glass-bg, rgba(255, 255, 255, 0.5));
        text-align: left;
      }
      
      body[data-theme="dark"] .mission-pillar {
        border-color: var(--sc-border-glass, rgba(255, 255, 255, 0.1));
        background: var(--sc-glass-bg, rgba(255, 255, 255, 0.05));
      }
      
      .mission-pillar-icon {
        font-size: 2rem;
        margin-bottom: 0.75rem;
      }
      
      .mission-pillar h3 {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
        color: var(--sc-text-primary);
      }
      
      .mission-pillar p {
        font-size: 0.95rem;
        margin: 0;
        color: var(--sc-text-secondary);
        line-height: 1.6;
      }
      
      .section-header {
        text-align: center;
        margin-bottom: 2.5rem;
      }
      
      .section-title {
        font-size: clamp(1.75rem, 4vw, 2.5rem);
        font-weight: 700;
        margin-bottom: 0.75rem;
        color: var(--sc-text-primary);
      }
      
      .section-kicker {
        font-size: 1rem;
        color: var(--sc-text-secondary);
        margin: 0;
      }
      
      .sticky-nav-links {
        display: none;
      }
      
      @media (min-width: 768px) {
        .mission-pillars {
          grid-template-columns: repeat(3, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <nav class="sticky-nav" id="sticky-nav">
      <div class="sticky-nav-content">
        <img src="images/logo_largo_principal.png" alt="Select Capital" class="sticky-nav-logo" />
        <div class="sticky-nav-links">
          <a href="#mision">Misi√≥n</a>
          <a href="#contacto">Contacto</a>
        </div>
      </div>
    </nav>

    <div class="page">
      <!-- HERO -->
      <header class="header">
        <div class="header-main">
          <div class="hero-content-wrapper">
            <div class="hero-text-content">
              <h1 class="headline">
                Asesor√≠a Integral<br />
                <span>Inmobiliaria</span>
              </h1>
              <p class="subheadline">
                Te encontramos el departamento ideal. Nosotros nos encargamos del resto.
              </p>
            </div>
          </div>
        </div>
      </header>

      <!-- MISI√ìN -->
      <section class="section mission-section" id="mision">
        <div class="mission-content">
          <h2 class="mission-title">Nuestra Misi√≥n</h2>
          <p class="mission-text">
            Curamos proyectos con demanda real, negociamos beneficios y te acompa√±amos hasta la puesta en arriendo.
          </p>
          
          <div class="mission-pillars">
            <div class="mission-pillar">
              <div class="mission-pillar-icon">üîç</div>
              <h3>Curadur√≠a experta</h3>
              <p>Zonas con demanda real de arriendo y conectividad.</p>
            </div>
            <div class="mission-pillar">
              <div class="mission-pillar-icon">ü§ù</div>
              <h3>Negociaci√≥n de beneficios</h3>
              <p>Obt√©n mejores condiciones y promociones exclusivas.</p>
            </div>
            <div class="mission-pillar">
              <div class="mission-pillar-icon">üè†</div>
              <h3>Acompa√±amiento completo</h3>
              <p>Desde la evaluaci√≥n hasta la puesta en arriendo.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- FORMULARIO -->
      <section class="section" id="contacto">
        <div class="section-header">
          <h2 class="section-title">Recibe tu propuesta</h2>
          <p class="section-kicker">D√©janos tus datos y te enviamos n√∫meros claros para tu caso</p>
        </div>

        <div class="form-card">
          <p class="text-block" style="margin-bottom: 16px;">
            Te enviaremos una propuesta con valor estimado de la unidad, pie, monto de dividendo y renta proyectada seg√∫n tu perfil. Sin costo y sin compromiso.
          </p>

          <form class="form" action="/submit.php" method="post">
            <div class="form-grid">
              <!-- Datos de contacto b√°sicos -->
              <div class="field">
                <label for="nombre">
                  <span>Nombre completo</span>
                </label>
                <input id="nombre" name="nombre" type="text" placeholder="Nombre y apellido" required />
              </div>

              <div class="field">
                <label for="telefono">
                  <span>Tel√©fono WhatsApp</span>
                </label>
                <input id="telefono" name="telefono" type="tel" placeholder="+56 9 1234 5678" required />
              </div>

              <div class="field" style="grid-column: 1 / -1;">
                <label for="correo">
                  <span>Correo electr√≥nico</span>
                </label>
                <input id="correo" name="correo" type="email" placeholder="tu@correo.cl" required />
              </div>

              <!-- Preguntas de calificaci√≥n financiera -->
              <div class="field">
                <label for="renta">
                  <span>¬øCu√°l es tu renta mensual promedio?</span>
                </label>
                <select id="renta" name="renta" required>
                  <option value="" disabled selected>Selecciona un rango</option>
                  <option value="menos-1200">Menos de $1.200.000</option>
                  <option value="1200-1600">$1.200.000 - $1.600.000</option>
                  <option value="1600-2000">$1.600.000 - $2.000.000</option>
                  <option value="2000-2500">$2.000.000 - $2.500.000</option>
                  <option value="2500-3000">$2.500.000 - $3.000.000</option>
                  <option value="mas-3000">M√°s de $3.000.000</option>
                </select>
              </div>

              <div class="field">
                <label for="complemento">
                  <span>¬øPuedes complementar renta?</span>
                </label>
                <select id="complemento" name="complemento" required>
                  <option value="" disabled selected>Selecciona una opci√≥n</option>
                  <option value="si-mas-1m">S√≠, y gana m√°s de $1.000.000</option>
                  <option value="no">No tengo complemento</option>
                </select>
              </div>

              <div class="field">
                <label for="situacion">
                  <span>¬øCu√°l es tu situaci√≥n financiera?</span>
                </label>
                <select id="situacion" name="situacion" required>
                  <option value="" disabled selected>Selecciona una opci√≥n</option>
                  <option value="sin-deudas">No poseo deudas y no estoy en Dicom</option>
                  <option value="con-deudas">Poseo deuda hipotecaria o de consumo</option>
                  <option value="dicom">Me encuentro en Dicom</option>
                </select>
              </div>

              <div class="field">
                <label for="ahorro">
                  <span>¬øCu√°l es tu capacidad de ahorro mensual?</span>
                </label>
                <select id="ahorro" name="ahorro" required>
                  <option value="" disabled selected>Selecciona un rango</option>
                  <option value="sin-ahorro">No tengo capacidad de ahorro</option>
                  <option value="100-200">$100.000 - $200.000</option>
                  <option value="200-400">$200.000 - $400.000</option>
                  <option value="mas-400">M√°s de $400.000</option>
                </select>
              </div>

              <!-- Preferencia de contacto simplificada -->
              <div class="field" style="grid-column: 1 / -1;">
                <label for="contacto">
                  <span>¬øC√≥mo prefieres que te contactemos?</span>
                </label>
                <select id="contacto" name="contacto" required>
                  <option value="" disabled selected>Selecciona una opci√≥n</option>
                  <option value="whatsapp">WhatsApp</option>
                  <option value="llamada">Llamada telef√≥nica</option>
                  <option value="email">Correo electr√≥nico</option>
                </select>
              </div>
            </div>

            <div class="field-checkbox">
              <input id="terminos" name="terminos" type="checkbox" required />
              <label for="terminos">
                Acepto el tratamiento de mis datos y autorizo el contacto por WhatsApp y correo para recibir informaci√≥n sobre proyectos inmobiliarios.
              </label>
            </div>

            <input type="hidden" name="cf-turnstile-response" id="ts-token" />
            
            <div class="form-footer">
              <p>‚è∞ Respuesta en menos de 24 horas. Sin costo y sin compromiso.</p>
              
              <div class="turnstile-container" style="margin: 16px 0; display: flex; justify-content: center;">
                <div class="cf-turnstile" data-sitekey="0x4AAAAAAB_bjq2YOWp-yEXx" data-theme="auto" data-callback="onTurnstileSuccess"></div>
              </div>

              <button type="submit" class="btn-primary" id="form-submit-btn" disabled>
                <span class="btn-primary-icon">üìÑ</span>
                <span>Recibir mi propuesta personalizada</span>
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer">
        <div>
          <img src="images/logo_negro.png" alt="Select Capital" class="footer-logo footer-logo-light" style="height: 32px; margin-bottom: 12px;" />
          <img src="images/logo_blanco.png" alt="Select Capital" class="footer-logo footer-logo-dark" style="height: 32px; margin-bottom: 12px; display: none;" />
          <p style="margin: 0 0 8px 0; font-size: 12px;">
            <strong>Select Capital</strong> ¬∑ Asesor√≠a Inmobiliaria<br />
            Av. Apoquindo 6410, Of. 1203, Las Condes
          </p>
        </div>
        <div>
          <div class="footer-contact">
            <a href="https://wa.me/56966013182?text=Hola,%20quiero%20informaci√≥n%20sobre%20la%20asesor√≠a%20inmobiliaria" target="_blank" rel="noopener" class="contact-link">
              <span>üí¨</span>
              <span>WhatsApp</span>
            </a>
            <a href="mailto:contacto@selectcapital.cl" class="contact-link">
              <span>‚úâÔ∏è</span>
              <span>contacto@selectcapital.cl</span>
            </a>
          </div>
          <p style="margin: 12px 0 0 0; font-size: 11px; color: var(--sc-text-tertiary, rgba(15, 23, 42, 0.5));">
            Asesor√≠a sin costo para el inversionista. Respuesta en menos de 24 horas.
          </p>
        </div>
      </footer>
    </div>

    <!-- Sticky CTA Button (Mobile) -->
    <div class="sticky-cta" id="sticky-cta">
      <button type="button" class="sticky-cta-button" data-action="scroll-form">
        <span class="btn-primary-icon">üìÑ</span>
        <span>Quiero mi propuesta</span>
      </button>
    </div>

    <!-- Cloudflare Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <script type="module" src="lenguaje visual/theme/theme-toggle.min.js"></script>
    <script>
      // Turnstile callback
      window.onTurnstileSuccess = function(token) {
        const tokenInput = document.getElementById('ts-token');
        const submitBtn = document.getElementById('form-submit-btn');
        if (tokenInput) {
          tokenInput.value = token;
        }
        if (submitBtn) {
          submitBtn.disabled = false;
        }
      };

      // Update theme icon based on current theme
      document.addEventListener('DOMContentLoaded', () => {
        const footerLogoLight = document.querySelector('.footer-logo-light');
        const footerLogoDark = document.querySelector('.footer-logo-dark');
        
        const updateTheme = () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          // Update footer logo visibility
          if (footerLogoLight && footerLogoDark) {
            if (currentTheme === 'dark') {
              footerLogoLight.style.display = 'none';
              footerLogoDark.style.display = 'block';
            } else {
              footerLogoLight.style.display = 'block';
              footerLogoDark.style.display = 'none';
            }
          }
        };
        
        // Initial update
        updateTheme();
        
        // Watch for theme changes
        const observer = new MutationObserver(() => {
          updateTheme();
        });
        
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['data-theme']
        });

        // Smooth scroll to form
        const scrollFormBtn = document.querySelector('[data-action="scroll-form"]');
        const stickyCtaBtn = document.querySelector('.sticky-cta-button[data-action="scroll-form"]');
        
        const scrollToForm = (e) => {
          if (e) e.preventDefault();
          const formSection = document.getElementById('contacto');
          if (formSection) {
            formSection.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
          }
        };
        
        if (scrollFormBtn) {
          scrollFormBtn.addEventListener('click', scrollToForm);
        }
        if (stickyCtaBtn) {
          stickyCtaBtn.addEventListener('click', scrollToForm);
        }

        // Sticky CTA visibility control
        const stickyCta = document.getElementById('sticky-cta');
        const formSection = document.getElementById('contacto');
        
        if (stickyCta && formSection) {
          const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
          };
          
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                stickyCta.classList.remove('is-visible');
              } else {
                const heroBottom = document.querySelector('.header')?.getBoundingClientRect().bottom || 0;
                if (window.scrollY > heroBottom + 100) {
                  stickyCta.classList.add('is-visible');
                } else {
                  stickyCta.classList.remove('is-visible');
                }
              }
            });
          }, observerOptions);
          
          observer.observe(formSection);
          
          // Also check on scroll
          let ticking = false;
          window.addEventListener('scroll', () => {
            if (!ticking) {
              window.requestAnimationFrame(() => {
                const heroBottom = document.querySelector('.header')?.getBoundingClientRect().bottom || 0;
                const formRect = formSection.getBoundingClientRect();
                const isFormVisible = formRect.top < window.innerHeight && formRect.bottom > 0;
                
                if (isFormVisible) {
                  stickyCta.classList.remove('is-visible');
                } else if (window.scrollY > heroBottom + 100) {
                  stickyCta.classList.add('is-visible');
                } else {
                  stickyCta.classList.remove('is-visible');
                }
                
                ticking = false;
              });
              ticking = true;
            }
          });
        }

        // ============================================
        // FORM FIELD HELPERS
        // ============================================
        
        // Format phone: +56 9 xxxx xxxx (on blur)
        function formatPhone(value) {
          if (!value) return '';
          let clean = value.replace(/\D/g, '');
          if (clean.startsWith('56')) clean = clean.slice(2);
          if (clean.startsWith('0')) clean = clean.slice(1);
          if (clean.length < 9) return value;
          clean = clean.slice(-9);
          return `+56 ${clean.slice(0,1)} ${clean.slice(1,5)} ${clean.slice(5,9)}`;
        }
        
        // Capitalize name
        function formatName(value) {
          if (!value) return '';
          const lower = ['de', 'del', 'la', 'las', 'los', 'el', 'y', 'e'];
          return value.trim().split(/\s+/).map((w, i) => {
            if (i > 0 && lower.includes(w.toLowerCase())) return w.toLowerCase();
            return w.charAt(0).toUpperCase() + w.slice(1).toLowerCase();
          }).join(' ');
        }
        
        // ============================================
        // APPLY FIELD FORMATTING
        // ============================================
        
        const form = document.querySelector('.form');
        if (form) {
          // Phone formatting
          const phoneInput = form.querySelector('#telefono');
          if (phoneInput) {
            phoneInput.addEventListener('blur', (e) => {
              e.target.value = formatPhone(e.target.value);
            });
          }
          
          // Email normalization
          const emailInput = form.querySelector('#correo');
          if (emailInput) {
            emailInput.addEventListener('blur', (e) => {
              e.target.value = e.target.value.trim().toLowerCase();
            });
          }
          
          // Name capitalization
          const nameInput = form.querySelector('#nombre');
          if (nameInput) {
            nameInput.addEventListener('blur', (e) => {
              e.target.value = formatName(e.target.value);
            });
          }
        }
        
        // ============================================
        // FORM SUBMISSION
        // ============================================
        const submitBtn = document.getElementById('form-submit-btn');
        
        if (form && submitBtn) {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const tokenInput = document.getElementById('ts-token');
            if (!tokenInput || !tokenInput.value) {
              showFormMessage('Por favor, completa la verificaci√≥n de seguridad antes de enviar.', 'error');
              return false;
            }

            // Format fields
            const telefonoInput = form.querySelector('#telefono');
            const correoInput = form.querySelector('#correo');
            const nombreInput = form.querySelector('#nombre');
            
            if (telefonoInput) {
              const formattedPhone = formatPhone(telefonoInput.value);
              telefonoInput.value = formattedPhone;
              
              if (!/^\+56\s9\s\d{4}\s\d{4}$/.test(formattedPhone)) {
                showFormMessage('Por favor, ingresa un n√∫mero de WhatsApp v√°lido (9 d√≠gitos).', 'error');
                telefonoInput.focus();
                return false;
              }
            }
            
            if (correoInput) correoInput.value = correoInput.value.trim().toLowerCase();
            if (nombreInput) nombreInput.value = formatName(nombreInput.value);

            // Disable button and show loading
            submitBtn.disabled = true;
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="btn-primary-icon">‚è≥</span><span>Enviando...</span>';
            submitBtn.style.opacity = '0.7';
            submitBtn.style.cursor = 'not-allowed';

            removeFormMessages();

            try {
              const formData = new FormData();
              
              // Contact info
              formData.append('nombre', form.querySelector('#nombre')?.value || '');
              formData.append('email', form.querySelector('#correo')?.value || '');
              formData.append('whatsapp', form.querySelector('#telefono')?.value || '');
              
              // Financial qualification
              formData.append('renta_rango', form.querySelector('#renta')?.value || '');
              formData.append('complemento_renta', form.querySelector('#complemento')?.value || '');
              formData.append('situacion_financiera', form.querySelector('#situacion')?.value || '');
              formData.append('capacidad_ahorro', form.querySelector('#ahorro')?.value || '');
              
              // Contact preference
              formData.append('canal_preferido', form.querySelector('#contacto')?.value || 'whatsapp');
              
              // Fixed values
              formData.append('proyecto', 'Asesor√≠a Integral');
              formData.append('objetivo', 'asesoria');
              
              // Consent
              const terminos = form.querySelector('#terminos')?.checked;
              formData.append('consentimiento_privacidad', terminos ? 'si' : 'no');
              formData.append('consentimiento_contacto', terminos ? 'si' : 'no');
              
              // Add Turnstile token
              formData.append('cf-turnstile-response', tokenInput.value);
              
              // Honeypot field (empty)
              formData.append('honey', '');
              
              // Add UTM parameters from URL if present
              const urlParams = new URLSearchParams(window.location.search);
              formData.append('utm_source', urlParams.get('utm_source') || '');
              formData.append('utm_medium', urlParams.get('utm_medium') || '');
              formData.append('utm_campaign', urlParams.get('utm_campaign') || '');
              formData.append('gclid', urlParams.get('gclid') || '');
              formData.append('fbclid', urlParams.get('fbclid') || '');
              formData.append('ttclid', urlParams.get('ttclid') || '');
              
              // Submit form
              const response = await fetch('/submit.php', {
                method: 'POST',
                body: formData
              });

              const result = await response.json();

              if (result.ok) {
                // Success - show message or redirect
                showFormMessage('¬°Gracias! Te contactaremos en menos de 24 horas.', 'success');
                form.reset();
                submitBtn.disabled = true;
                const tsInput = document.getElementById('ts-token');
                if (tsInput) tsInput.value = '';
              } else {
                throw new Error(result.message || 'Error al enviar el formulario');
              }
            } catch (error) {
              // Log error in development only
              if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.includes('dev.')) {
                console.error('Form submission error:', error);
              }
              showFormMessage(
                error.message || 'Hubo un problema al enviar tu solicitud. Por favor intenta nuevamente.',
                'error'
              );
            } finally {
              // Re-enable button
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalText;
              submitBtn.style.opacity = '1';
              submitBtn.style.cursor = 'pointer';
            }
          });
        }

        // Helper functions for form messages
        function showFormMessage(message, type) {
          removeFormMessages();
          
          const messageEl = document.createElement('div');
          messageEl.className = `form-message ${type}`;
          messageEl.innerHTML = `
            <strong>${type === 'success' ? '‚úì' : '‚ö†'}</strong>
            <span>${message}</span>
          `;
          messageEl.style.cssText = `
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 18px;
            border-radius: 12px;
            margin: 16px 0;
            font-size: 14px;
            line-height: 1.5;
            ${type === 'success' 
              ? 'background: rgba(34, 197, 94, 0.1); border: 1.5px solid rgba(34, 197, 94, 0.3); color: #16a34a;' 
              : 'background: rgba(248, 113, 113, 0.1); border: 1.5px solid rgba(248, 113, 113, 0.3); color: #dc2626;'
            }
          `;
          
          const formFooter = document.querySelector('.form-footer');
          if (formFooter) {
            formFooter.insertBefore(messageEl, formFooter.firstChild);
          }
        }

        function removeFormMessages() {
          document.querySelectorAll('.form-message').forEach(el => el.remove());
        }
      });

      // Auto-detect system theme
      const setThemeFromSystem = () => {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = prefersDark ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
      };

      // Set initial theme
      setThemeFromSystem();

      // Listen for system theme changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setThemeFromSystem);

      // Smooth scroll for sticky nav links
      document.querySelectorAll('.sticky-nav-links a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('href');
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
            window.scrollTo({
              top: offsetTop,
              behavior: 'smooth'
            });
          }
        });
      });
    </script>
  </body>
</html>

