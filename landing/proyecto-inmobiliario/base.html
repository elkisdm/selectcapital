<!doctype html>
<html lang="es" data-theme="light" data-theme-transition>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VIVA MAR√çN | Inversi√≥n en Santiago Centro ‚Äî Select Capital</title>
    <meta name="description" content="Invierte en VIVA MAR√çN en Santiago Centro desde UF 2.350. Pie 10% en 48 cuotas, 15% descuento lanzamiento. Asesor√≠a sin costo." />
    <meta name="theme-color" content="#F6F8FC" />
    <link rel="icon" href="/images/icono.png" />
    
    <!-- DNS Prefetch para recursos externos -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="dns-prefetch" href="https://challenges.cloudflare.com" />
    
    <!-- Preconnect para recursos cr√≠ticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Preload de fuente cr√≠tica -->
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiJ-Ek-_EeA.woff2" as="font" type="font/woff2" crossorigin />
    
    <!-- Fuentes con font-display swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- CSS cr√≠tico -->
    <link rel="stylesheet" href="/lenguaje visual/theme/select-capital-theme.min.css?v=66e592e976" />
    <link rel="stylesheet" href="/lenguaje visual/forms/sc-forms.css?v=20250118" />
    <link rel="stylesheet" href="/landing/proyecto-inmobiliario/viva-marin-styles.css?v=20250118-4" />
  </head>
  <body>
    <button class="theme-toggle" type="button" data-theme-toggle aria-label="Cambiar tema">
      <span data-theme-icon>üåô</span>
    </button>

    <nav class="sticky-nav" id="sticky-nav">
      <div class="sticky-nav-content">
        <img src="/images/logo_blanco.png" alt="Select Capital" class="sticky-nav-logo" />
        <div class="sticky-nav-links">
          <a href="#tipologias">Tipolog√≠as</a>
          <a href="#ubicacion">Ubicaci√≥n</a>
          <a href="#contacto">Cotizar</a>
        </div>
      </div>
    </nav>

    <div class="page">
      <!-- HEADER / HERO -->
      <header class="header">
        <div class="header-logo">
          <img src="/images/logo_negro.png" alt="Select Capital" class="logo-light" />
          <img src="/images/logo_blanco.png" alt="Select Capital" class="logo-dark" style="display: none;" />
        </div>

        <div class="header-main">
          <div class="hero-content-wrapper">
            <div class="hero-text-content">
              <h1 class="headline">
                Invierte en <span>VIVA MAR√çN</span> en Santiago Centro<br />
                desde UF 2.350
              </h1>
              <p class="subheadline">
                Edificio de solo 162 departamentos en esquina Mar√≠n con Lira, pensado para quienes quieren vivir o invertir en el coraz√≥n de Santiago Centro sin perder tranquilidad.
              </p>

              <!-- Hero Image - M√≥vil: despu√©s del t√≠tulo y subt√≠tulo -->
              <div class="hero-media-mobile">
                <div class="hero-tagline">VIVA MAR√çN ‚Äî Santiago Centro</div>
                <div class="hero-title">Esquina Mar√≠n con Lira ¬∑ 162 departamentos</div>
                <div class="hero-image-placeholder">
                  <img src="/images/viva marin/fachada.png" alt="Fachada principal VIVA MAR√çN" loading="eager" fetchpriority="high" width="600" height="800" decoding="async" />
                </div>
            </div>

              <div class="header-grid">
                <div class="pill">
                  <span>Promoci√≥n lanzamiento</span>
                  <strong>15% de descuento</strong>
                </div>
                <div class="pill">
                  <span>Pie 10%</span>
                  <strong>En hasta 48 cuotas</strong>
                </div>
                <div class="pill">
                  <span>Tipolog√≠as</span>
                  <strong>Estudio ¬∑ 1D ¬∑ 2D</strong>
                </div>
                <div class="pill">
                  <span>Entrega estimada</span>
                  <strong>Mediados 2028</strong>
                </div>
              </div>
            </div>

            <div class="hero-cta-section">
              <button type="button" class="hero-cta-primary" data-action="scroll-form">
                <span class="btn-primary-icon">üìÑ</span>
                <span>Quiero mi propuesta</span>
              </button>
            </div>
            </div>

          <!-- Hero Image - Desktop: lado derecho -->
          <div class="hero-media">
            <div class="hero-tagline">VIVA MAR√çN ‚Äî Santiago Centro</div>
            <div class="hero-title">Esquina Mar√≠n con Lira ¬∑ 162 departamentos</div>
            <div class="hero-image-placeholder">
              <img src="/images/viva marin/fachada.png" alt="Fachada principal VIVA MAR√çN" loading="eager" fetchpriority="high" width="600" height="800" decoding="async" />
              </div>
              </div>
            </div>
      </header>

      <!-- DATOS CLAVE / DESCRIPCI√ìN -->
      <section class="section" id="datos-clave">
        <div class="section-header">
          <h2 class="section-title">Datos clave del proyecto</h2>
          <p class="section-kicker">Resumen r√°pido: precio de entrada, etapas y contexto</p>
            </div>

        <div class="card" style="margin-bottom: 16px;">
          <div class="card-grid">
            <div>
              <div class="metric-label">Desde</div>
              <div class="metric-value">UF 2.350</div>
              <div class="metric-hint">Valores referenciales</div>
            </div>
            <div>
              <div class="metric-label">Tipolog√≠as</div>
              <div class="metric-value">Estudio ¬∑ 1D ¬∑ 2D</div>
              <div class="metric-hint">162 departamentos</div>
        </div>
            <div>
              <div class="metric-label">Pie</div>
              <div class="metric-value">10% en 48 cuotas</div>
              <div class="metric-hint">Promoci√≥n lanzamiento</div>
              </div>
            <div>
              <div class="metric-label">Entrega</div>
              <div class="metric-value">Mediados 2028</div>
              <div class="metric-hint">Etapa verde</div>
            </div>
          </div>
        </div>

        <div class="description-showcase">
          <div class="description-card">
            <div class="description-icon">üìç</div>
            <div class="description-content">
              <h3 class="description-title">Ubicaci√≥n estrat√©gica</h3>
              <p class="description-text">
                En la esquina de <strong>Mar√≠n con Lira</strong>, en pleno coraz√≥n de Santiago Centro, se levanta <strong>VIVA Mar√≠n</strong>: un edificio de solo 162 departamentos ‚Äî 1 y 2 dormitorios ‚Äî pensado para quienes buscan conectar con la ciudad sin sacrificar tranquilidad.
              </p>
              </div>
            </div>

          <div class="description-features">
            <div class="feature-item">
              <span class="feature-icon">üöá</span>
              <span class="feature-text">A pasos de metro</span>
              </div>
            <div class="feature-item">
              <span class="feature-icon">üè•</span>
              <span class="feature-text">Hospitales cercanos</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üéì</span>
              <span class="feature-text">Universidades</span>
          </div>
            <div class="feature-item">
              <span class="feature-icon">üõí</span>
              <span class="feature-text">Comercio urbano</span>
        </div>
          </div>

          <div class="description-highlight">
            <div class="highlight-badge">üöÄ Futura L√≠nea 9</div>
            <p class="highlight-text">
              La futura <strong>L√≠nea 9 del Metro de Santiago</strong> se trazar√° por la Avenida Santa Rosa, lo que incrementa la expectativa de <strong>valorizaci√≥n del sector</strong> en el mediano plazo.
            </p>
          </div>
        </div>
      </section>

      <!-- EXPERIENCIA / AMENITIES -->
      <section class="section" id="experiencia">
        <div class="section-header">
          <h2 class="section-title">Experiencia del proyecto</h2>
          <p class="section-kicker">Espacios comunes, amenities y zonas pensadas para el d√≠a a d√≠a</p>
              </div>

        <div class="amenities-grid">
          <article class="amenity-card">
            <div class="amenity-media">
              <img src="/images/viva marin/fachada.png" alt="Fachada principal VIVA MAR√çN" loading="lazy" width="400" height="533" decoding="async" />
            </div>
            <div class="amenity-title">Fachada principal</div>
            <div class="amenity-caption">Arquitectura moderna que se integra al tejido urbano de Santiago Centro.</div>
          </article>

          <article class="amenity-card">
            <div class="amenity-media">
              <img src="/images/viva marin/halldepto.png" alt="Living VIVA MAR√çN" loading="lazy" width="400" height="533" decoding="async" />
              </div>
            <div class="amenity-title">Living</div>
            <div class="amenity-caption">Espacios amplios y luminosos para disfrutar en familia.</div>
          </article>

          <article class="amenity-card">
            <div class="amenity-media">
              <img src="/images/viva marin/cocina.png" alt="Cocina VIVA MAR√çN" loading="lazy" width="400" height="533" decoding="async" />
            </div>
            <div class="amenity-title">Cocina</div>
            <div class="amenity-caption">Dise√±o moderno y funcional con equipamiento de primera calidad.</div>
          </article>

          <article class="amenity-card">
            <div class="amenity-media">
              <img src="/images/viva marin/dormitorio.png" alt="Habitaci√≥n VIVA MAR√çN" loading="lazy" width="400" height="533" decoding="async" />
          </div>
            <div class="amenity-title">Habitaci√≥n</div>
            <div class="amenity-caption">Dormitorios amplios y confortables para tu descanso.</div>
          </article>
        </div>
      </section>

      <!-- TIPOLOG√çAS Y PLANOS -->
      <section class="section" id="tipologias">
        <div class="section-header">
          <h2 class="section-title">Tipolog√≠as disponibles</h2>
          <p class="section-kicker">Conoce los departamentos y sus superficies</p>
          </div>

        <div class="typologies-grid">
          <!-- Studio -->
          <article class="typology-card">
            <div class="typology-image-wrapper" data-lightbox="true" data-image="/images/viva marin/render_studio.png" data-title="Studio - DEPTO 310 AL 910">
              <img src="/images/viva marin/render_studio.png" alt="Plano Studio VIVA MAR√çN" loading="lazy" decoding="async" />
        </div>
            <div class="typology-content">
              <div class="typology-header">
                <h3 class="typology-title">Studio</h3>
                <span class="typology-badge">DEPTO 310 AL 910</span>
              </div>
              <div class="typology-specs">
                <div class="spec-item">
                  <span class="spec-label">Superficie Interior</span>
                  <span class="spec-value">20.62 m¬≤</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Sup. Terraza (100%)</span>
                  <span class="spec-value">0.00 m¬≤</span>
                </div>
                <div class="spec-item spec-total">
                  <span class="spec-label">SUP. TOTAL</span>
                  <span class="spec-value">20.62 m¬≤</span>
                </div>
              </div>
            </div>
          </article>

          <!-- 1 Dormitorio -->
          <article class="typology-card">
            <div class="typology-image-wrapper" data-lightbox="true" data-image="/images/viva marin/render_1d1b.png" data-title="1 Dormitorio - DEPTO 308 AL 908">
              <img src="/images/viva marin/render_1d1b.png" alt="Plano 1 Dormitorio VIVA MAR√çN" loading="lazy" decoding="async" />
          </div>
            <div class="typology-content">
              <div class="typology-header">
                <h3 class="typology-title">1 Dormitorio</h3>
                <span class="typology-badge">DEPTO 308 AL 908</span>
        </div>
              <div class="typology-specs">
                <div class="spec-item">
                  <span class="spec-label">Superficie Interior</span>
                  <span class="spec-value">29.25 m¬≤</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Sup. Terraza (100%)</span>
                  <span class="spec-value">2.00 m¬≤</span>
                </div>
                <div class="spec-item spec-total">
                  <span class="spec-label">SUP. TOTAL</span>
                  <span class="spec-value">31.25 m¬≤</span>
                </div>
              </div>
            </div>
          </article>

          <!-- 2 Dormitorios -->
          <article class="typology-card">
            <div class="typology-image-wrapper" data-lightbox="true" data-image="/images/viva marin/render_2d2b.png" data-title="2 Dormitorios - DEPTO 202 AL 902">
              <img src="/images/viva marin/render_2d2b.png" alt="Plano 2 Dormitorios VIVA MAR√çN" loading="lazy" decoding="async" />
            </div>
            <div class="typology-content">
              <div class="typology-header">
                <h3 class="typology-title">2 Dormitorios</h3>
                <span class="typology-badge">DEPTO 202 AL 902</span>
              </div>
              <div class="typology-specs">
                <div class="spec-item">
                  <span class="spec-label">Superficie Interior</span>
                  <span class="spec-value">49.40 m¬≤</span>
            </div>
                <div class="spec-item">
                  <span class="spec-label">Sup. Terraza (100%)</span>
                  <span class="spec-value">2.03 m¬≤</span>
          </div>
                <div class="spec-item spec-total">
                  <span class="spec-label">SUP. TOTAL</span>
                  <span class="spec-value">51.43 m¬≤</span>
                </div>
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- UBICACI√ìN Y CONECTIVIDAD -->
      <section class="section" id="ubicacion">
        <div class="section-header">
          <h2 class="section-title">Ubicaci√≥n y conectividad</h2>
          <p class="section-kicker">Todo lo que necesitas, a minutos caminando</p>
          </div>

        <div class="location-grid">
          <div>
            <ul class="list">
              <li>
                <div class="list-icon">üéì</div>
                <div class="list-content">
                  <span>Educaci√≥n</span>
                  <strong>Universidad Cat√≥lica ¬∑ 5 min</strong>
        </div>
              </li>
              <li>
                <div class="list-icon">üõí</div>
                <div class="list-content">
                  <span>Comercio</span>
                  <strong>Strip Center Portugal ¬∑ 6 min</strong>
            </div>
              </li>
              <li>
                <div class="list-icon">üöá</div>
                <div class="list-content">
                  <span>Metro</span>
                  <strong>Santa Luc√≠a ¬∑ 10 min</strong>
          </div>
              </li>
              <li>
                <div class="list-icon">üè•</div>
                <div class="list-content">
                  <span>Salud</span>
                  <strong>Hospital del Salvador ¬∑ 6 min</strong>
        </div>
              </li>
            </ul>

            <p class="text-block" style="margin-top: 16px;">
              Est√°s en el <strong>centro hist√≥rico de Santiago</strong>, una zona con alta plusval√≠a por su conectividad, servicios y vida urbana. Ideal para renta de largo plazo y para profesionales que buscan cercan√≠a con todo.
              </p>
          </div>

          <div class="map-card">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3329.5!2d-70.648!3d-33.437!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9662c5a8b8b8b8b9%3A0x8b8b8b8b8b8b8b8b!2sCalle%20Mar%C3%ADn%20%26%20Calle%20Lira%2C%20Santiago%2C%20Regi%C3%B3n%20Metropolitana!5e0!3m2!1ses!2scl!4v1700000000000!5m2!1ses!2scl" 
              width="100%" 
              height="400" 
              style="border:0; border-radius: var(--lp-radius-lg);" 
              allowfullscreen="" 
              loading="lazy" 
              referrerpolicy="no-referrer-when-downgrade"
              title="Ubicaci√≥n VIVA MAR√çN - Esquina Mar√≠n con Lira, Santiago Centro">
            </iframe>
            <div class="map-overlay">
              <a href="https://www.google.com/maps/search/?api=1&query=Mar√≠n+Lira+Santiago+Centro" target="_blank" rel="noopener" class="map-link">
                <span>üìç Esquina Mar√≠n con Lira, Santiago Centro</span>
                <span style="font-size: 10px; opacity: 0.8;">Abrir en Google Maps</span>
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- POR QU√â INVERTIR AHORA -->
      <section class="section" id="por-que-invertir">
        <div class="section-header">
          <h2 class="section-title">¬øPor qu√© invertir ahora?</h2>
          <p class="section-kicker">Contexto de mercado y oportunidad concreta en VIVA MAR√çN</p>
          </div>

        <div class="why-invest-grid">
          <div class="why-invest-card">
            <div class="why-invest-icon">üìâ</div>
            <h3 class="why-invest-title">Tasas en baja</h3>
            <p class="why-invest-text">
              Las <strong>tasas de inter√©s hipotecarias han comenzado a bajar</strong>, lo que mejora la accesibilidad al cr√©dito y reduce el costo total del financiamiento.
            </p>
          </div>

          <div class="why-invest-card">
            <div class="why-invest-icon">üìà</div>
            <h3 class="why-invest-title">Alta demanda</h3>
            <p class="why-invest-text">
              Est√°s en una zona con <strong>alta demanda de arriendo y oferta moderada</strong>, lo que proyecta buena estabilidad de ocupaci√≥n y valorizaci√≥n futura.
            </p>
          </div>

          <div class="why-invest-card">
            <div class="why-invest-icon">üå±</div>
            <h3 class="why-invest-title">Etapa verde</h3>
            <p class="why-invest-text">
              VIVA MAR√çN se encuentra en <strong>etapa verde</strong>: puedes pagar el pie en cuotas y capturar plusval√≠a desde la construcci√≥n.
            </p>
          </div>
            </div>

        <div class="why-invest-highlights">
          <div class="highlight-pill">
            <span class="highlight-pill-icon">üìâ</span>
            <span>Baja gradual de tasas hipotecarias</span>
                  </div>
          <div class="highlight-pill">
            <span class="highlight-pill-icon">üìà</span>
            <span>Alta demanda de arriendo en Santiago Centro</span>
                  </div>
          <div class="highlight-pill">
            <span class="highlight-pill-icon">üå±</span>
            <span>Etapa verde: pie en cuotas</span>
                  </div>
          <div class="highlight-pill">
            <span class="highlight-pill-icon">üöá</span>
            <span>Proyecci√≥n positiva por futura L√≠nea 9</span>
          </div>
        </div>
      </section>

      <!-- PROCESO DE INVERSI√ìN -->
      <section class="section" id="proceso">
        <div class="section-header">
          <h2 class="section-title">Proceso de inversi√≥n</h2>
          <p class="section-kicker">Acompa√±amiento desde el diagn√≥stico hasta la firma de promesa</p>
              </div>

        <div class="steps-grid">
          <article class="step-card">
            <div class="step-index">1</div>
            <div class="step-title">An√°lisis financiero</div>
            <p class="step-text">
              Revisamos tu documentaci√≥n y dise√±amos una propuesta adaptada tanto a tu perfil de inversionista como a tu situaci√≥n financiera actual.
            </p>
          </article>

          <article class="step-card">
            <div class="step-index">2</div>
            <div class="step-title">Preaprobaci√≥n bancaria</div>
            <p class="step-text">
              Coordinamos con nuestros ejecutivos para obtener una o m√°s preaprobaciones de cr√©dito, dejando tu financiamiento encaminado antes de reservar.
            </p>
          </article>

          <article class="step-card">
            <div class="step-index">3</div>
            <div class="step-title">Reserva de la unidad</div>
            <p class="step-text">
              Realizas la reserva para asegurar la unidad seleccionada mientras ultimamos detalles de la promesa de compraventa.
            </p>
          </article>

          <article class="step-card">
            <div class="step-index">4</div>
            <div class="step-title">Firma de promesa</div>
            <p class="step-text">
              Firmas la promesa de compraventa, que fija precio, plazos y condiciones, entreg√°ndote seguridad jur√≠dica antes de la escritura final.
            </p>
          </article>
            </div>
      </section>

      <!-- PREGUNTAS FRECUENTES -->
      <section class="section" id="faq">
        <div class="section-header">
          <h2 class="section-title">Preguntas frecuentes</h2>
          <p class="section-kicker">Resolvemos las dudas m√°s comunes antes de invertir</p>
                  </div>

        <div class="faq-grid">
          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üí∞</span>
              <span>¬øC√≥mo se divide el pie 10%?</span>
                  </div>
            <div class="faq-a">El pie se divide en cuotas, permiti√©ndote entrar al proyecto con menor esfuerzo inicial. Detalle exacto seg√∫n condiciones vigentes al momento de la reserva.</div>
                  </div>

          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üìã</span>
              <span>¬øQu√© necesito para promesar?</span>
                </div>
            <div class="faq-a">Contar con una preaprobaci√≥n bancaria vigente y cumplir con la documentaci√≥n solicitada por la inmobiliaria y el banco.</div>
              </div>

          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üìÖ</span>
              <span>¬øCu√°ndo se entrega el proyecto?</span>
                </div>
            <div class="faq-a">La entrega estimada es a mediados de 2028, sujeta al avance de la obra y permisos correspondientes.</div>
                </div>

          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üöó</span>
              <span>¬øHay estacionamientos y bodegas?</span>
                </div>
            <div class="faq-a">S√≠, hay opciones de estacionamientos y bodegas sujetos a disponibilidad y valores vigentes al momento de la reserva.</div>
                </div>

          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üéÅ</span>
              <span>¬øQu√© incluye la promoci√≥n?</span>
            </div>
            <div class="faq-a">Promoci√≥n de lanzamiento con un 15% de descuento sobre el valor de lista, v√°lida para unidades y plazos definidos por el desarrollador.</div>
                </div>

          <div class="faq-item">
            <div class="faq-q">
              <span class="faq-icon">üí≥</span>
              <span>¬øHay gastos adicionales?</span>
                </div>
            <div class="faq-a">S√≠, los habituales gastos operacionales, notariales y seguros al momento de la escrituraci√≥n del cr√©dito hipotecario.</div>
              </div>
        </div>
      </section>

      <!-- FORMULARIO / MULTISTEP WIZARD -->
      <section class="section" id="contacto">
        <div class="wizard-container">
          <form class="form wizard-form" action="/submit.php" method="post" id="wizard-form">
            <input type="hidden" name="cf-turnstile-response" id="ts-token" />
            
            <!-- Stepper Indicator -->
            <div class="wizard-stepper">
              <div class="wizard-stepper-inner">
                <div class="step-indicator active" data-step="1">
                  <span class="step-number">1</span>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="2">
                  <span class="step-number">2</span>
                </div>
                <div class="step-connector"></div>
                <div class="step-indicator" data-step="3">
                  <span class="step-number">3</span>
                </div>
              </div>
            </div>
            
            <!-- Step 1: Informaci√≥n Personal -->
            <div id="step-1" class="step">
              <div class="wizard-step-content">
                <div class="wizard-step-header">
                  <h2 class="wizard-step-title">Informaci√≥n personal</h2>
                  <p class="wizard-step-subtitle">Comencemos con tus datos b√°sicos</p>
                </div>
                
                <div class="form-card">
                  <div class="field field-floating">
                    <input id="nombre" name="nombre" type="text" placeholder=" " required />
                    <label for="nombre">Nombre completo</label>
                  </div>

                  <div class="field field-floating">
                    <input id="rut" name="rut" type="text" placeholder=" " required />
                    <label for="rut">RUT</label>
                  </div>

                  <div class="field field-floating">
                    <input id="telefono" name="telefono" type="tel" placeholder=" " required />
                    <label for="telefono">Tel√©fono WhatsApp</label>
                  </div>

                  <div class="field field-floating">
                    <input id="correo" name="correo" type="email" placeholder=" " required />
                    <label for="correo">Correo electr√≥nico</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 2: Perfil Financiero -->
            <div id="step-2" class="step">
              <div class="wizard-step-content">
                <div class="wizard-step-header">
                  <h2 class="wizard-step-title">Tu perfil financiero</h2>
                  <p class="wizard-step-subtitle">Ay√∫danos a conocerte mejor</p>
                </div>
                
                <div class="form-card">
                  <div class="question-group">
                    <h3 class="question-title">¬øCu√°l es tu objetivo con esta inversi√≥n?</h3>
                    <div class="option-buttons" role="radiogroup" aria-label="Objetivo">
                      <label class="option-button" data-value="invertir">
                        <input type="radio" id="objetivo-invertir" name="objetivo" value="invertir" required />
                        <span>Invertir para renta</span>
                      </label>
                      <label class="option-button" data-value="vivir">
                        <input type="radio" id="objetivo-vivir" name="objetivo" value="vivir" required />
                        <span>Comprar para vivir</span>
                      </label>
                      <label class="option-button" data-value="no-se">
                        <input type="radio" id="objetivo-no-se" name="objetivo" value="no-se" required />
                        <span>A√∫n no lo tengo claro</span>
                      </label>
                    </div>
                  </div>

                  <div class="question-group">
                    <h3 class="question-title">¬øCu√°l es tu renta l√≠quida mensual?</h3>
                    <p class="question-hint">Las entidades financieras solicitan una renta m√≠nima desde $1.400.000 para cr√©dito hipotecario.</p>
                    <div class="option-buttons" role="radiogroup" aria-label="Renta l√≠quida">
                      <label class="option-button" data-value="renta-1">
                        <input type="radio" id="renta-1" name="renta-rango" value="1000001-1400000" required />
                        <span>Entre $1.000.001 - $1.400.000</span>
                      </label>
                      <label class="option-button" data-value="renta-2">
                        <input type="radio" id="renta-2" name="renta-rango" value="1400001-1800000" required />
                        <span>Entre $1.400.001 - $1.800.000</span>
                      </label>
                      <label class="option-button" data-value="renta-3">
                        <input type="radio" id="renta-3" name="renta-rango" value="1800001+" required />
                        <span>M√°s de $1.800.001</span>
                      </label>
                    </div>
                  </div>

                  <div class="question-group">
                    <h3 class="question-title">¬øCu√°l es tu capacidad de ahorro mensual aproximadamente?</h3>
                    <div class="option-buttons" role="radiogroup" aria-label="Capacidad de ahorro">
                      <label class="option-button" data-value="ahorro-0">
                        <input type="radio" id="ahorro-0" name="ahorro-mensual" value="0" required />
                        <span>No tengo capacidad de ahorro mensual</span>
                      </label>
                      <label class="option-button" data-value="ahorro-1">
                        <input type="radio" id="ahorro-1" name="ahorro-mensual" value="100000-200000" required />
                        <span>Entre $100.000 - $200.000</span>
                      </label>
                      <label class="option-button" data-value="ahorro-2">
                        <input type="radio" id="ahorro-2" name="ahorro-mensual" value="200001-400000" required />
                        <span>Entre $200.001 - $400.000</span>
                      </label>
                      <label class="option-button" data-value="ahorro-3">
                        <input type="radio" id="ahorro-3" name="ahorro-mensual" value="400001+" required />
                        <span>M√°s de $400.001</span>
                      </label>
                    </div>
                  </div>

                  <div class="question-group">
                    <h3 class="question-title">¬øQu√© tipo de propiedad te interesa?</h3>
                    <div class="option-buttons" role="radiogroup" aria-label="Tipo de propiedad">
                      <label class="option-button" data-value="studio">
                        <input type="radio" id="tipo-studio" name="tipo" value="studio" required />
                        <span>Studio</span>
                      </label>
                      <label class="option-button" data-value="1d">
                        <input type="radio" id="tipo-1d" name="tipo" value="1d" required />
                        <span>1 Dormitorio</span>
                      </label>
                      <label class="option-button" data-value="2d">
                        <input type="radio" id="tipo-2d" name="tipo" value="2d" required />
                        <span>2 Dormitorios</span>
                      </label>
                      <label class="option-button" data-value="todas">
                        <input type="radio" id="tipo-todas" name="tipo" value="todas" required />
                        <span>Todas las opciones</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Step 3: Contacto y T√©rminos -->
            <div id="step-3" class="step">
              <div class="wizard-step-content">
                <div class="wizard-step-header">
                  <h2 class="wizard-step-title">√öltimo paso</h2>
                  <p class="wizard-step-subtitle">C√≥mo prefieres que te contactemos</p>
                </div>
                
                <div class="form-card">
                  <div class="question-group">
                    <h3 class="question-title">¬øC√≥mo prefieres que te contactemos?</h3>
                    <div class="option-buttons" role="radiogroup" aria-label="Preferencia de contacto">
                      <label class="option-button" data-value="whatsapp">
                        <input type="radio" id="contacto-whatsapp" name="contacto-preferencia" value="whatsapp" required />
                        <span>WhatsApp</span>
                      </label>
                      <label class="option-button" data-value="email">
                        <input type="radio" id="contacto-email" name="contacto-preferencia" value="email" required />
                        <span>Correo</span>
                      </label>
                      <label class="option-button" data-value="llamada">
                        <input type="radio" id="contacto-llamada" name="contacto-preferencia" value="llamada" required />
                        <span>Llamada</span>
                      </label>
                    </div>
                  </div>

                  <div class="field-checkbox">
                    <input id="terminos" name="terminos" type="checkbox" required />
                    <label for="terminos">
                      Acepto el tratamiento de mis datos y autorizo el contacto por WhatsApp y correo para recibir informaci√≥n sobre este proyecto inmobiliario.
                    </label>
                  </div>

                  <!-- Submit button inside step-3, right after checkbox -->
                  <button type="submit" id="form-submit-btn" class="wizard-btn wizard-btn-primary" style="margin-top: 1rem; width: 100%;">
                    <span class="btn-primary-icon">üìÑ</span>
                    <span>Recibir mi propuesta personalizada</span>
                  </button>

                  <div class="turnstile-container" style="margin: 16px 0; display: flex; justify-content: center;">
                    <div class="cf-turnstile" data-sitekey="0x4AAAAAAB_bjq2YOWp-yEXx" data-theme="auto" data-callback="onTurnstileSuccess"></div>
                  </div>

                  <p class="text-xs text-gray-500 text-center mt-4">‚è∞ Oferta sujeta a disponibilidad de unidades y vigencia de la promoci√≥n de lanzamiento.</p>
                </div>
              </div>
            </div>

            <!-- Bottom CTA Zone -->
            <div class="wizard-cta">
              <div class="wizard-cta-inner">
                <button type="button" id="wizard-next-btn" class="wizard-btn wizard-btn-primary">
                  Siguiente
                </button>
                <button type="button" id="wizard-back-btn" class="wizard-btn wizard-btn-secondary hidden">
                  Atr√°s
                </button>
              </div>
            </div>
          </form>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer">
        <div>
          <img src="/images/logo_negro.png" alt="Select Capital" class="footer-logo footer-logo-light" style="height: 32px; margin-bottom: 12px;" />
          <img src="/images/logo_blanco.png" alt="Select Capital" class="footer-logo footer-logo-dark" style="height: 32px; margin-bottom: 12px; display: none;" />
          <p style="margin: 0 0 8px 0; font-size: 12px;">
            <strong>Select Capital</strong> ¬∑ Asesor√≠a Inmobiliaria<br />
            Av. Apoquindo 6410, Of. 1203, Las Condes
          </p>
        </div>
        <div>
          <div class="footer-contact">
            <a href="https://wa.me/56966013182?text=Hola,%20quiero%20informaci√≥n%20sobre%20VIVA%20MAR√çN" target="_blank" rel="noopener" class="contact-link">
              <span>üí¨</span>
              <span>WhatsApp</span>
            </a>
            <a href="mailto:contacto@selectcapital.cl" class="contact-link">
              <span>‚úâÔ∏è</span>
              <span>contacto@selectcapital.cl</span>
            </a>
          </div>
          <p style="margin: 12px 0 0 0; font-size: 11px; color: var(--sc-text-tertiary, rgba(15, 23, 42, 0.5));">
            Promociones y precios en UF, sujetos a disponibilidad y modificaciones del plan de obra.
          </p>
        </div>
      </footer>
    </div>

    <!-- Sticky CTA Button (Mobile) -->
    <div class="sticky-cta" id="sticky-cta">
      <button type="button" class="sticky-cta-button" data-action="scroll-form">
        <span class="btn-primary-icon">üìÑ</span>
        <span>Quiero mi propuesta</span>
      </button>
    </div>

    <!-- Cloudflare Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <script type="module" src="/lenguaje visual/theme/theme-toggle.min.js"></script>
    <script>
      // Turnstile callback
      window.onTurnstileSuccess = function(token) {
        const tokenInput = document.getElementById('ts-token');
        const submitBtn = document.getElementById('form-submit-btn');
        if (tokenInput) {
          tokenInput.value = token;
        }
        if (submitBtn) {
          submitBtn.disabled = false;
        }
      };

      // Update theme icon based on current theme
      // ============================================
      // WIZARD MULTISTEP LOGIC
      // ============================================
      let currentStep = 0;
      const totalSteps = 3;

      function goToStep(stepIndex) {
        if (stepIndex < 0 || stepIndex >= totalSteps) return;

        // Hide all steps
        document.querySelectorAll('.step').forEach((step, index) => {
          step.classList.remove('active');
          step.style.position = 'absolute';
          step.style.opacity = '0';
          step.style.pointerEvents = 'none';
          step.style.zIndex = '1';
        });

        // Show current step
        const currentStepEl = document.getElementById(`step-${stepIndex + 1}`);
        if (currentStepEl) {
          currentStepEl.style.position = 'relative';
          currentStepEl.style.pointerEvents = 'auto';
          currentStepEl.style.zIndex = '2';
          currentStepEl.style.display = 'flex';
          setTimeout(() => {
            currentStepEl.classList.add('active');
            currentStepEl.style.opacity = '1';
            
            // Scroll to top of wizard container to ensure proper centering
            const wizardContainer = document.querySelector('.wizard-container');
            if (wizardContainer) {
              wizardContainer.scrollTop = 0;
            }
          }, 50);
        }

        // Update stepper indicators
        document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
          if (index <= stepIndex) {
            indicator.classList.add('active');
          } else {
            indicator.classList.remove('active');
          }
        });

        // Update step connectors
        document.querySelectorAll('.step-connector').forEach((connector, index) => {
          if (index < stepIndex) {
            connector.classList.add('active');
          } else {
            connector.classList.remove('active');
          }
        });

        // Update buttons
        const nextBtn = document.getElementById('wizard-next-btn');
        const backBtn = document.getElementById('wizard-back-btn');
        const submitBtn = document.getElementById('form-submit-btn');

        if (stepIndex === 0) {
          backBtn?.classList.add('hidden');
        } else {
          backBtn?.classList.remove('hidden');
        }

        if (stepIndex === totalSteps - 1) {
          // Last step: hide next button, show back button
          nextBtn?.classList.add('hidden');
          // Show submit button (it's inside step-3)
          if (submitBtn) {
            submitBtn.style.display = 'flex';
          }
        } else {
          nextBtn?.classList.remove('hidden');
          // Hide submit button in steps 1 and 2
          if (submitBtn) {
            submitBtn.style.display = 'none';
          }
        }

        currentStep = stepIndex;
      }

      function validateStep(stepIndex) {
        const stepEl = document.getElementById(`step-${stepIndex + 1}`);
        if (!stepEl) return false;

        const requiredFields = stepEl.querySelectorAll('input[required], select[required]');
        let isValid = true;

        requiredFields.forEach(field => {
          // Skip hidden fields (like turnstile token)
          if (field.type === 'hidden') return;

          // For radio buttons, check if at least one in the group is checked
          if (field.type === 'radio') {
            const groupName = field.name;
            const groupChecked = stepEl.querySelector(`input[name="${groupName}"]:checked`);
            if (!groupChecked) {
              isValid = false;
              // Highlight the option group
              const optionGroup = field.closest('.option-grid, .contact-options, .option-buttons');
              if (optionGroup) {
                optionGroup.style.border = '1px solid rgba(239, 68, 68, 0.5)';
                optionGroup.style.borderRadius = '0.5rem';
                optionGroup.style.padding = '0.5rem';
                setTimeout(() => {
                  optionGroup.style.border = '';
                  optionGroup.style.borderRadius = '';
                  optionGroup.style.padding = '';
                }, 2000);
              }
            }
          } else if (field.type === 'checkbox') {
            if (!field.checked) {
              isValid = false;
              field.style.borderColor = 'rgba(239, 68, 68, 0.5)';
              setTimeout(() => {
                field.style.borderColor = '';
              }, 2000);
            }
          } else {
            // Text inputs, email, tel, etc.
            if (!field.value.trim()) {
              isValid = false;
              field.style.borderColor = 'rgba(239, 68, 68, 0.5)';
              setTimeout(() => {
                field.style.borderColor = '';
              }, 2000);
            }
          }
        });

        return isValid;
      }

      // Open wizard function (global scope)
      function openWizard(e) {
        if (e) e.preventDefault();
        const wizardContainer = document.querySelector('.wizard-container');
        if (wizardContainer) {
          // Show wizard container
          wizardContainer.style.display = 'flex';
          wizardContainer.classList.add('active');
          document.body.style.overflow = 'hidden';
          
          // Reset to first step
          currentStep = 0;
          
          // Hide all steps first
          document.querySelectorAll('.step').forEach(step => {
            step.classList.remove('active');
            step.style.position = 'absolute';
            step.style.opacity = '0';
            step.style.pointerEvents = 'none';
          });
          
          // Show first step
          const firstStep = document.getElementById('step-1');
          if (firstStep) {
            firstStep.style.position = 'relative';
            firstStep.style.pointerEvents = 'auto';
            setTimeout(() => {
              firstStep.classList.add('active');
              firstStep.style.opacity = '1';
            }, 50);
          }
          
          // Update buttons and indicators
          goToStep(0);
          
          // Scroll to top
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }

      // Scroll to form function
      function scrollToForm(e) {
        if (e) e.preventDefault();
        // Now opens wizard instead of scrolling
        openWizard(e);
      }

      // Initialize wizard
      document.addEventListener('DOMContentLoaded', () => {
        // Wizard navigation
        const nextBtn = document.getElementById('wizard-next-btn');
        const backBtn = document.getElementById('wizard-back-btn');

        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
            if (validateStep(currentStep)) {
              goToStep(currentStep + 1);
            }
          });
        }

        if (backBtn) {
          backBtn.addEventListener('click', () => {
            goToStep(currentStep - 1);
          });
        }

        // Initialize wizard (hidden by default)
        const wizardContainer = document.querySelector('.wizard-container');
        if (wizardContainer) {
          // Hide all steps initially
          document.querySelectorAll('.step').forEach(step => {
            step.classList.remove('active');
            step.style.display = 'none';
          });
          // Hide submit button initially (it's only shown in step-3)
          const submitBtn = document.getElementById('form-submit-btn');
          if (submitBtn) {
            submitBtn.style.display = 'none';
          }
          // Prepare first step (but don't show wizard yet)
          const firstStep = document.getElementById('step-1');
          if (firstStep) {
            firstStep.style.display = 'flex';
            firstStep.classList.add('active');
          }
        }

        // Connect buttons to open wizard
        const allScrollFormBtns = document.querySelectorAll('[data-action="scroll-form"]');
        allScrollFormBtns.forEach((btn) => {
          btn.addEventListener('click', openWizard);
        });
      });

      document.addEventListener('DOMContentLoaded', () => {
        const themeIcon = document.querySelector('[data-theme-icon]');
        const logoLight = document.querySelector('.header-logo .logo-light');
        const logoDark = document.querySelector('.header-logo .logo-dark');
        const footerLogoLight = document.querySelector('.footer-logo-light');
        const footerLogoDark = document.querySelector('.footer-logo-dark');
        
        const updateTheme = () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          if (themeIcon) {
            themeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
          }
          // Update header logo visibility
          if (logoLight && logoDark) {
            if (currentTheme === 'dark') {
              logoLight.style.display = 'none';
              logoDark.style.display = 'block';
            } else {
              logoLight.style.display = 'block';
              logoDark.style.display = 'none';
            }
          }
          // Update footer logo visibility
          if (footerLogoLight && footerLogoDark) {
            if (currentTheme === 'dark') {
              footerLogoLight.style.display = 'none';
              footerLogoDark.style.display = 'block';
            } else {
              footerLogoLight.style.display = 'block';
              footerLogoDark.style.display = 'none';
            }
          }
        };
        
        // Initial update
        updateTheme();
        
        // Watch for theme changes
        const observer = new MutationObserver(() => {
          updateTheme();
        });
        
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['data-theme']
        });


        // Sticky CTA visibility control
        const stickyCta = document.getElementById('sticky-cta');
        const formSection = document.getElementById('contacto');
        
        if (stickyCta && formSection) {
          const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
          };
          
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                // Form is visible, hide sticky CTA
                stickyCta.classList.remove('is-visible');
              } else {
                // Form is not visible, show sticky CTA (only if scrolled past hero)
                const heroBottom = document.querySelector('.header')?.getBoundingClientRect().bottom || 0;
                if (window.scrollY > heroBottom + 100) {
                  stickyCta.classList.add('is-visible');
                } else {
                  stickyCta.classList.remove('is-visible');
                }
              }
            });
          }, observerOptions);
          
          observer.observe(formSection);
          
          // Also check on scroll
          let ticking = false;
          window.addEventListener('scroll', () => {
            if (!ticking) {
              window.requestAnimationFrame(() => {
                const heroBottom = document.querySelector('.header')?.getBoundingClientRect().bottom || 0;
                const formRect = formSection.getBoundingClientRect();
                const isFormVisible = formRect.top < window.innerHeight && formRect.bottom > 0;
                
                if (isFormVisible) {
                  stickyCta.classList.remove('is-visible');
                } else if (window.scrollY > heroBottom + 100) {
                  stickyCta.classList.add('is-visible');
                } else {
                  stickyCta.classList.remove('is-visible');
                }
                
                ticking = false;
              });
              ticking = true;
            }
          });
        }

        // ============================================
        // FORM FIELD NORMALIZATION FUNCTIONS
        // ============================================
        
        // Normalize RUT: Format to 12.345.678-9 and validate
        function normalizeRUT(value, cursorPosition) {
          if (!value) return { formatted: '', newCursorPos: 0 };
          
          cursorPosition = cursorPosition || 0;
          
          // Count how many digits are before the cursor in the original value
          const beforeCursor = value.substring(0, cursorPosition);
          let digitsBeforeCursor = (beforeCursor.match(/[0-9kK]/g) || []).length;
          
          // Remove all non-alphanumeric except dots and dash
          let clean = value.replace(/[^0-9kK\.-]/g, '');
          
          // Extract number and digit
          const parts = clean.split('-');
          let number = parts[0]?.replace(/\./g, '') || '';
          let digit = parts[1] || '';
          
          // Only extract digit if we have 8 or more digits (complete RUT)
          // Don't extract digit while user is still typing (less than 8 digits)
          if (!digit && number.length >= 8) {
            // Extract last char as digit if we have 8+ digits
            digit = number.slice(-1);
            number = number.slice(0, -1);
            // Adjust cursor if we extracted the last char
            if (digitsBeforeCursor > number.length) {
              digitsBeforeCursor = number.length;
            }
          } else if (!digit && number.length === 7 && number.slice(-1).toLowerCase() === 'k') {
            // Special case: if we have 7 digits ending in 'k', extract it
            digit = number.slice(-1).toUpperCase();
            number = number.slice(0, -1);
            if (digitsBeforeCursor > number.length) {
              digitsBeforeCursor = number.length;
            }
          }
          
          // Format number with dots
          let formatted = '';
          let newCursorPos = 0;
          
          if (number) {
            number = number.replace(/\D/g, '');
            
            // Build formatted string from left to right, adding dots every 3 digits from right
            let digitCount = 0;
            for (let i = 0; i < number.length; i++) {
              // Add dot before every group of 3 digits (from right)
              // Dots appear at positions: length-3, length-6, length-9, etc.
              if (i > 0 && (number.length - i) % 3 === 0) {
                formatted += '.';
                // If cursor is at or after this position, account for the dot
                if (digitsBeforeCursor > i) {
                  newCursorPos++;
                }
              }
              formatted += number[i];
              digitCount++;
              
              // If cursor is right after this digit
              if (digitsBeforeCursor === digitCount) {
                newCursorPos = formatted.length;
              }
            }
            
            // If cursor is at the end of the number
            if (digitsBeforeCursor >= number.length) {
              newCursorPos = formatted.length;
            }
            
            // Add dash and digit only if we have a complete RUT (7 digits + 1 digit)
            if (digit && number.length >= 7) {
              formatted = formatted + '-' + digit.toUpperCase();
              // If cursor was at or after the last digit of the number, move it after the dash+digit
              if (digitsBeforeCursor >= number.length) {
                newCursorPos = formatted.length;
              }
            }
          } else {
            formatted = clean;
            newCursorPos = Math.min(cursorPosition, formatted.length);
          }
          
          return { formatted, newCursorPos };
        }
        
        // Validate RUT digit
        function validateRUT(rut) {
          if (!rut) return false;
          
          const clean = rut.replace(/\./g, '').replace(/-/g, '');
          if (clean.length < 8 || clean.length > 10) return false;
          
          const number = clean.slice(0, -1);
          const digit = clean.slice(-1).toUpperCase();
          
          let sum = 0;
          let multiplier = 2;
          
          for (let i = number.length - 1; i >= 0; i--) {
            sum += parseInt(number[i]) * multiplier;
            multiplier = multiplier === 7 ? 2 : multiplier + 1;
          }
          
          const remainder = sum % 11;
          const calculatedDigit = remainder < 2 ? remainder.toString() : (11 - remainder).toString();
          const expectedDigit = calculatedDigit === '11' ? '0' : calculatedDigit === '10' ? 'K' : calculatedDigit;
          
          return digit === expectedDigit;
        }
        
        // Normalize phone/WhatsApp: Format to +56 9 xxxx xxxx
        function normalizePhone(value) {
          if (!value) return '';
          
          // Remove all non-digits
          let clean = value.replace(/\D/g, '');
          
          // If starts with 56, keep it; otherwise assume it's a Chilean number
          if (clean.startsWith('56')) {
            clean = clean.substring(2);
          }
          
          // Remove leading 0 if present
          if (clean.startsWith('0')) {
            clean = clean.substring(1);
          }
          
          // Ensure it starts with 9 (Chilean mobile)
          if (!clean.startsWith('9') && clean.length >= 8) {
            clean = '9' + clean;
          }
          
          // Format: +56 9 xxxx xxxx
          if (clean.length >= 8) {
            const area = clean.substring(0, 1); // 9
            const part1 = clean.substring(1, 5); // xxxx
            const part2 = clean.substring(5, 9); // xxxx
            return `+56 ${area} ${part1} ${part2}`.trim();
          }
          
          return value; // Return as-is if can't format
        }
        
        // Normalize email: trim and lowercase
        function normalizeEmail(value) {
          if (!value) return '';
          return value.trim().toLowerCase();
        }
        
        // Normalize name: Proper capitalization
        function normalizeName(value) {
          if (!value) return '';
          
          return value
            .trim()
            .split(/\s+/)
            .map(word => {
              if (word.length === 0) return '';
              // Handle special prefixes (de, del, la, etc.)
              const lowerWords = ['de', 'del', 'la', 'las', 'los', 'el', 'y', 'e'];
              if (lowerWords.includes(word.toLowerCase())) {
                return word.toLowerCase();
              }
              // Capitalize first letter, lowercase rest
              return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
            })
            .join(' ');
        }
        
        // Normalize number: Remove formatting, keep only digits
        function normalizeNumber(value) {
          if (!value) return '';
          // Remove all non-digits except decimal point
          return value.replace(/[^\d]/g, '');
        }
        
        // Format number with thousands separator
        function formatNumber(value) {
          if (!value) return '';
          const clean = normalizeNumber(value);
          if (!clean) return '';
          return clean.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        // ============================================
        // APPLY NORMALIZATION TO FORM FIELDS
        // ============================================
        
        const form = document.querySelector('.form');
        if (form) {
          // RUT normalization
          const rutInput = form.querySelector('#rut');
          if (rutInput) {
            rutInput.addEventListener('input', (e) => {
              const cursorPos = e.target.selectionStart;
              const result = normalizeRUT(e.target.value, cursorPos);
              
              if (result.formatted !== e.target.value) {
                e.target.value = result.formatted;
                // Set cursor to calculated position
                const newPos = Math.max(0, Math.min(result.newCursorPos, result.formatted.length));
                e.target.setSelectionRange(newPos, newPos);
              }
            });
            
            rutInput.addEventListener('blur', (e) => {
              const result = normalizeRUT(e.target.value, e.target.selectionStart);
              const normalized = result.formatted;
              
              if (normalized && !validateRUT(normalized)) {
                e.target.style.borderColor = 'rgba(248, 113, 113, 0.5)';
              } else {
                e.target.style.borderColor = '';
              }
              e.target.value = normalized;
            });
          }
          
          // Phone normalization
          const phoneInput = form.querySelector('#telefono');
          if (phoneInput) {
            phoneInput.addEventListener('input', (e) => {
              const normalized = normalizePhone(e.target.value);
              if (normalized !== e.target.value) {
                const cursorPos = e.target.selectionStart;
                e.target.value = normalized;
                const newPos = Math.min(cursorPos, normalized.length);
                e.target.setSelectionRange(newPos, newPos);
              }
            });
            
            phoneInput.addEventListener('blur', (e) => {
              const normalized = normalizePhone(e.target.value);
              e.target.value = normalized;
            });
          }
          
          // Email normalization
          const emailInput = form.querySelector('#correo');
          if (emailInput) {
            emailInput.addEventListener('blur', (e) => {
              e.target.value = normalizeEmail(e.target.value);
            });
          }
          
          // Name normalization
          const nameInput = form.querySelector('#nombre');
          if (nameInput) {
            nameInput.addEventListener('blur', (e) => {
              e.target.value = normalizeName(e.target.value);
            });
          }
          
          // Number formatting for renta
          const rentaInput = form.querySelector('#renta');
          if (rentaInput) {
            rentaInput.addEventListener('input', (e) => {
              const clean = normalizeNumber(e.target.value);
              if (clean) {
                const formatted = formatNumber(clean);
                if (formatted !== e.target.value) {
                  const cursorPos = e.target.selectionStart;
                  e.target.value = formatted;
                  const newPos = Math.min(cursorPos, formatted.length);
                  e.target.setSelectionRange(newPos, newPos);
                }
              }
            });
          }
          
          // Ahorro field (allow text like "No tengo")
          const ahorroInput = form.querySelector('#ahorro');
          if (ahorroInput) {
            ahorroInput.addEventListener('input', (e) => {
              const value = e.target.value;
              // If it's not "no tengo" or similar, format as number
              if (!/no\s+tengo/i.test(value) && /\d/.test(value)) {
                const clean = normalizeNumber(value);
                if (clean) {
                  const formatted = formatNumber(clean);
                  if (formatted !== value) {
                    const cursorPos = e.target.selectionStart;
                    e.target.value = formatted;
                    const newPos = Math.min(cursorPos, formatted.length);
                    e.target.setSelectionRange(newPos, newPos);
                  }
                }
              }
            });
          }
        }
        
        // Form validation and submission
        const submitBtn = document.getElementById('form-submit-btn');
        
        if (form && submitBtn) {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const tokenInput = document.getElementById('ts-token');
            if (!tokenInput || !tokenInput.value) {
              showFormMessage('Por favor, completa la verificaci√≥n de seguridad antes de enviar.', 'error');
              return false;
            }

            // Normalize all fields before validation
            const rutInput = form.querySelector('#rut');
            const telefonoInput = form.querySelector('#telefono');
            const correoInput = form.querySelector('#correo');
            const nombreInput = form.querySelector('#nombre');
            const rentaInput = form.querySelector('#renta');
            const ahorroInput = form.querySelector('#ahorro');
            
            // Normalize RUT
            if (rutInput) {
              const result = normalizeRUT(rutInput.value, rutInput.selectionStart);
              const normalizedRUT = result.formatted;
              rutInput.value = normalizedRUT;
              
              if (normalizedRUT && !validateRUT(normalizedRUT)) {
                showFormMessage('Por favor, ingresa un RUT v√°lido. El d√≠gito verificador no es correcto.', 'error');
                rutInput.focus();
                return false;
              }
              
              if (normalizedRUT) {
                const cleanRut = normalizedRUT.replace(/\./g, '').replace(/-/g, '');
                if (cleanRut.length < 8 || cleanRut.length > 10) {
                  showFormMessage('Por favor, ingresa un RUT v√°lido en formato: 12.345.678-9', 'error');
                  rutInput.focus();
                  return false;
                }
              }
            }
            
            // Normalize phone
            if (telefonoInput) {
              const normalizedPhone = normalizePhone(telefonoInput.value);
              telefonoInput.value = normalizedPhone;
              
              const whatsappPattern = /^\+56\s9\s\d{4}\s\d{4}$/;
              if (normalizedPhone && !whatsappPattern.test(normalizedPhone)) {
                showFormMessage('Por favor, ingresa un n√∫mero de WhatsApp v√°lido en formato: +56 9 xxxx xxxx', 'error');
                telefonoInput.focus();
                return false;
              }
            }
            
            // Normalize email
            if (correoInput) {
              correoInput.value = normalizeEmail(correoInput.value);
            }
            
            // Normalize name
            if (nombreInput) {
              nombreInput.value = normalizeName(nombreInput.value);
            }
            
            // Normalize numbers (remove formatting for backend)
            if (rentaInput) {
              rentaInput.dataset.originalValue = rentaInput.value; // Store formatted for display
            }
            
            if (ahorroInput) {
              const ahorroValue = ahorroInput.value;
              if (!/no\s+tengo/i.test(ahorroValue) && /\d/.test(ahorroValue)) {
                ahorroInput.dataset.originalValue = ahorroValue; // Store formatted
              }
            }

            // Disable button and show loading state
            submitBtn.disabled = true;
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="btn-primary-icon">‚è≥</span><span>Enviando...</span>';
            submitBtn.style.opacity = '0.7';
            submitBtn.style.cursor = 'not-allowed';

            // Remove any existing messages
            removeFormMessages();

            try {
              // Create FormData and map fields to backend expected format
              const formData = new FormData();
              
              // Map form fields to backend expected fields (using normalized values)
              formData.append('nombre', form.querySelector('#nombre')?.value || '');
              formData.append('rut', form.querySelector('#rut')?.value || '');
              formData.append('email', form.querySelector('#correo')?.value || '');
              formData.append('whatsapp', form.querySelector('#telefono')?.value || '');
              // Get objetivo from radio button
              const objetivoRadio = form.querySelector('input[name="objetivo"]:checked');
              formData.append('objetivo', objetivoRadio?.value || '');
              formData.append('tipo_ingreso', 'dependiente'); // Default value (form doesn't have this field)
              
              // Handle renta - check for new radio buttons first, then fallback to input
              const rentaRangoRadio = form.querySelector('input[name="renta-rango"]:checked');
              let rentaValue = '';
              if (rentaRangoRadio) {
                rentaValue = rentaRangoRadio.value;
                // Map range to approximate value for backend
                if (rentaValue === '1000001-1400000') {
                  formData.append('renta_liquida', '1200000');
                } else if (rentaValue === '1400001-1800000') {
                  formData.append('renta_liquida', '1600000');
                } else if (rentaValue === '1800001+') {
                  formData.append('renta_liquida', '2000000');
                } else {
                  formData.append('renta_liquida', '0');
                }
              } else {
                // Fallback to old input field
                const rentaInput = form.querySelector('#renta');
                rentaValue = rentaInput?.value || '';
                formData.append('renta_liquida', normalizeNumber(rentaValue) || '0');
              }
              
              // Handle ahorro mensual - check for new radio buttons first
              const ahorroMensualRadio = form.querySelector('input[name="ahorro-mensual"]:checked');
              let capacidadAhorro = '0';
              let tieneAhorro = 'si';
              let montoAhorro = '0';
              
              if (ahorroMensualRadio) {
                const ahorroValue = ahorroMensualRadio.value;
                if (ahorroValue === '0') {
                  tieneAhorro = 'no';
                  capacidadAhorro = '0';
                  montoAhorro = '0';
                } else if (ahorroValue === '100000-200000') {
                  capacidadAhorro = '150000';
                  montoAhorro = '150000';
                } else if (ahorroValue === '200001-400000') {
                  capacidadAhorro = '300000';
                  montoAhorro = '300000';
                } else if (ahorroValue === '400001+') {
                  capacidadAhorro = '500000';
                  montoAhorro = '500000';
                }
              } else {
                // Fallback to old input field
                const ahorroInput = form.querySelector('#ahorro');
                const ahorroValue = ahorroInput?.value || '';
                tieneAhorro = /no\s+tengo/i.test(ahorroValue) ? 'no' : 'si';
                if (tieneAhorro === 'si' && /\d/.test(ahorroValue)) {
                  montoAhorro = normalizeNumber(ahorroValue) || '0';
                  capacidadAhorro = montoAhorro;
                }
              }
              
              formData.append('tiene_ahorro', tieneAhorro);
              formData.append('monto_ahorro', montoAhorro);
              formData.append('capacidad_ahorro_mensual', capacidadAhorro);
              
              formData.append('comunas_interes', 'Santiago Centro'); // Project location
              // Get canal_preferido from radio button
              const contactoRadio = form.querySelector('input[name="contacto-preferencia"]:checked');
              formData.append('canal_preferido', contactoRadio?.value || 'whatsapp');
              
              // Get tipo from radio button
              const tipoRadio = form.querySelector('input[name="tipo"]:checked');
              formData.append('tipo_ingreso_independiente', tipoRadio?.value || '');
              formData.append('franja_preferida', 'flexible'); // Default value (form doesn't have this field)
              formData.append('consentimiento_privacidad', form.querySelector('#terminos')?.checked ? 'si' : 'no');
              formData.append('consentimiento_contacto', form.querySelector('#terminos')?.checked ? 'si' : 'no');
              
              // Add tipo as comentarios for reference
              const tipoValue = form.querySelector('#tipo')?.value || '';
              if (tipoValue) {
                formData.append('comentarios', `Tipo de propiedad de inter√©s: ${tipoValue}`);
              }
              
              // Add Turnstile token
              formData.append('cf-turnstile-response', tokenInput.value);
              
              // Honeypot field (empty)
              formData.append('honey', '');
              
              // Submit form
              const response = await fetch('/submit.php', {
                method: 'POST',
                body: formData
              });

              const result = await response.json();

              if (result.ok) {
                // Success - redirect to gracias page
                const nombre = form.querySelector('#nombre')?.value || '';
                const redirectUrl = `/landing/proyecto-inmobiliario/gracias.html${nombre ? '?nombre=' + encodeURIComponent(nombre) : ''}`;
                window.location.href = redirectUrl;
              } else {
                throw new Error(result.message || 'Error al enviar el formulario');
              }
            } catch (error) {
              // Log error in development only
              if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.includes('dev.')) {
                console.error('Form submission error:', error);
              }
              showFormMessage(
                error.message || 'Hubo un problema al enviar tu solicitud. Por favor intenta nuevamente.',
                'error'
              );
              
              // Re-enable button
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalText;
              submitBtn.style.opacity = '1';
              submitBtn.style.cursor = 'pointer';
            }
          });
        }

        // Helper functions for form messages
        function showFormMessage(message, type) {
          removeFormMessages();
          
          const messageEl = document.createElement('div');
          messageEl.className = `form-message ${type}`;
          messageEl.innerHTML = `
            <strong>${type === 'success' ? '‚úì' : '‚ö†'}</strong>
            <span>${message}</span>
          `;
          messageEl.style.cssText = `
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 18px;
            border-radius: 12px;
            margin: 16px 0;
            font-size: 14px;
            line-height: 1.5;
            ${type === 'success' 
              ? 'background: rgba(34, 197, 94, 0.1); border: 1.5px solid rgba(34, 197, 94, 0.3); color: #16a34a;' 
              : 'background: rgba(248, 113, 113, 0.1); border: 1.5px solid rgba(248, 113, 113, 0.3); color: #dc2626;'
            }
          `;
          
          const formFooter = document.querySelector('.form-footer');
          if (formFooter) {
            formFooter.insertBefore(messageEl, formFooter.firstChild);
          }
        }

        function removeFormMessages() {
          document.querySelectorAll('.form-message').forEach(el => el.remove());
        }

        // ============================================
        // LIGHTBOX / MODAL FOR TYPOLOGY IMAGES
        // ============================================
        const lightboxModal = document.createElement('div');
        lightboxModal.className = 'lightbox-modal';
        lightboxModal.innerHTML = `
          <div class="lightbox-backdrop"></div>
          <div class="lightbox-content">
            <button class="lightbox-close" aria-label="Cerrar" type="button">
              <span>√ó</span>
        </button>
            <div class="lightbox-image-wrapper">
              <img class="lightbox-image" src="" alt="" />
      </div>
            <div class="lightbox-title"></div>
          </div>
        `;
        document.body.appendChild(lightboxModal);

        const lightboxBackdrop = lightboxModal.querySelector('.lightbox-backdrop');
        const lightboxClose = lightboxModal.querySelector('.lightbox-close');
        const lightboxImage = lightboxModal.querySelector('.lightbox-image');
        const lightboxTitle = lightboxModal.querySelector('.lightbox-title');

        function openLightbox(imageSrc, title) {
          lightboxImage.src = imageSrc;
          lightboxImage.alt = title;
          lightboxTitle.textContent = title;
          lightboxModal.classList.add('is-open');
          document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
          lightboxModal.classList.remove('is-open');
          document.body.style.overflow = '';
        }

        // Event listeners for lightbox
        document.querySelectorAll('[data-lightbox="true"]').forEach(wrapper => {
          wrapper.style.cursor = 'pointer';
          wrapper.addEventListener('click', (e) => {
            e.preventDefault();
            const imageSrc = wrapper.getAttribute('data-image');
            const title = wrapper.getAttribute('data-title') || '';
            openLightbox(imageSrc, title);
          });
        });

        // Close on backdrop click
        lightboxBackdrop.addEventListener('click', closeLightbox);

        // Close on close button click
        lightboxClose.addEventListener('click', closeLightbox);

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && lightboxModal.classList.contains('is-open')) {
            closeLightbox();
          }
        });
      });

      // Sticky Navigation
      const stickyNav = document.getElementById('sticky-nav');
      const mainThemeToggle = document.querySelector('.theme-toggle[data-theme-toggle]');
      const mainThemeIcon = document.querySelector('[data-theme-icon]');

      // Show/hide sticky nav on scroll
      let lastScroll = 0;
      window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll > 200) {
          stickyNav.classList.add('is-visible');
        } else {
          stickyNav.classList.remove('is-visible');
        }
        
        lastScroll = currentScroll;
      });

      // Sync theme icon when theme changes
      const syncThemeIcon = () => {
        // Read theme from documentElement (html tag), not body
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        const icon = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        if (mainThemeIcon) mainThemeIcon.textContent = icon;
      };

      // Observer for theme changes - observe documentElement, not body
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'data-theme') {
            syncThemeIcon();
          }
        });
      });

      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
      });


      // Smooth scroll for sticky nav links
      document.querySelectorAll('.sticky-nav-links a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('href');
          const targetElement = document.querySelector(targetId);
          
          if (targetElement) {
            const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
            window.scrollTo({
              top: offsetTop,
              behavior: 'smooth'
            });
          }
        });
      });

        // Initialize theme icon
        syncThemeIcon();

        // Option Cards Interaction Handler (legacy)
        document.querySelectorAll('.option-card').forEach(card => {
          const radio = card.querySelector('input[type="radio"]');
          
          // Update card appearance when radio is checked/unchecked
          radio.addEventListener('change', () => {
            // Remove selected class from all cards in the same group
            const group = card.closest('.option-grid, .option-cards, .contact-options');
            if (group) {
              group.querySelectorAll('.option-card').forEach(c => {
                c.classList.remove('selected');
              });
            }
            
            // Add selected class to checked card
            if (radio.checked) {
              card.classList.add('selected');
            }
          });
          
          // Initialize selected state
          if (radio.checked) {
            card.classList.add('selected');
          }
        });

        // Option Buttons Interaction Handler (new Capitalizarme style)
        document.querySelectorAll('.option-button').forEach(button => {
          const radio = button.querySelector('input[type="radio"]');
          
          // Update button appearance when radio is checked/unchecked
          radio.addEventListener('change', () => {
            // Remove selected class from all buttons in the same group
            const group = button.closest('.option-buttons');
            if (group) {
              group.querySelectorAll('.option-button').forEach(b => {
                b.classList.remove('selected');
              });
            }
            
            // Add selected class to checked button
            if (radio.checked) {
              button.classList.add('selected');
            }
          });
          
          // Initialize selected state
          if (radio.checked) {
            button.classList.add('selected');
          }
        });
    </script>
  </body>
</html>

